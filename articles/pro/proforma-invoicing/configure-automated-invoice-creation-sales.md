---
title: Настройка автоматического создания счетов
description: В этой теме содержится информация о настройке автоматического создания счетов-проформы.
author: rumant
manager: Annbe
ms.date: 04/05/2021
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 359c5902e0b6a08ab7fc982095062e4d1816db6c
ms.sourcegitcommit: ca0fc078d1a12484eca193fe051b8442c0559db8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/07/2021
ms.locfileid: "5866833"
---
# <a name="set-up-automatic-invoice-creation"></a><span data-ttu-id="c3460-103">Настройка автоматического создания счетов</span><span class="sxs-lookup"><span data-stu-id="c3460-103">Set up automatic invoice creation</span></span> 
 
<span data-ttu-id="c3460-104">_**Относится к:** Облегченное развертывание — от сделки до счетов-проформ, Project Operations для сценариев на основе ресурсов/нескладируемых запасов_</span><span class="sxs-lookup"><span data-stu-id="c3460-104">_**Applies To:** Lite deployment - deal to proforma invoicing, Project Operations for resource/non-stocked based scenarios_</span></span>

<span data-ttu-id="c3460-105">Вы можете настроить автоматическое создание счетов в Dynamics 365 Project Operations.</span><span class="sxs-lookup"><span data-stu-id="c3460-105">You can configure automatic invoice creation in Dynamics 365 Project Operations.</span></span> <span data-ttu-id="c3460-106">Система создает черновик счета-проформы на основе графика счетов для каждого контракта по проекту и строки контракта.</span><span class="sxs-lookup"><span data-stu-id="c3460-106">The system creates a draft proforma invoice based on the invoice schedule for each project contract and contract line.</span></span> <span data-ttu-id="c3460-107">Графики выставления счетов настраиваются на уровне строки контракта.</span><span class="sxs-lookup"><span data-stu-id="c3460-107">Invoice schedules are configured at the contract line level.</span></span> <span data-ttu-id="c3460-108">Каждая строка в контракте может иметь отдельный график счетов, или один и тот же график счетов может быть включен в каждую строку контракта.</span><span class="sxs-lookup"><span data-stu-id="c3460-108">Each line on a contract can have a distinct invoice schedule, or the same invoice schedule can be included on every line of the contract.</span></span>

<span data-ttu-id="c3460-109">При создании счета система всегда создает как минимум один счет для каждого контракта по проекту.</span><span class="sxs-lookup"><span data-stu-id="c3460-109">When you create an invoice, the system always creates at least one invoice per project contract.</span></span> <span data-ttu-id="c3460-110">В некоторых случаях может быть создано несколько счетов.</span><span class="sxs-lookup"><span data-stu-id="c3460-110">In some cases, there may be multiple invoices created.</span></span> <span data-ttu-id="c3460-111">Например, если в контракте указано несколько клиентов, будет создано такое же количество счетов, как и количество клиентов, у которых есть оплачиваемые транзакции для выставления счетов по этому контракту по проекту.</span><span class="sxs-lookup"><span data-stu-id="c3460-111">For example, if the contract has multiple customers, the same number of invoices will be created as the number of customers that have billable transactions to invoice on that project contract.</span></span>

## <a name="understand-how-transactions-are-included-on-an-invoice"></a><span data-ttu-id="c3460-112">Сведения о том, как транзакции включаются в счет</span><span class="sxs-lookup"><span data-stu-id="c3460-112">Understand how transactions are included on an invoice</span></span> 

<span data-ttu-id="c3460-113">Иногда для каждой строки контракта на основе проекта указывается отдельный график выставления счетов.</span><span class="sxs-lookup"><span data-stu-id="c3460-113">Sometimes, each project-based contract line specifies a separate invoice schedule.</span></span> <span data-ttu-id="c3460-114">Например, услуги по реализации для контракта Adatum включают следующие строки контракта:</span><span class="sxs-lookup"><span data-stu-id="c3460-114">For example, implementation services for the Adatum contract have the following contract lines:</span></span>

- <span data-ttu-id="c3460-115">Работа по созданию прототипа по фиксированной цене с двумя вехами, созданными вручную.</span><span class="sxs-lookup"><span data-stu-id="c3460-115">Prototype work that is a fixed price with two manually created milestones.</span></span>
- <span data-ttu-id="c3460-116">Счета за работу по реализации, включающие время, будут выставляться раз в две недели по понедельникам.</span><span class="sxs-lookup"><span data-stu-id="c3460-116">Implementation work that includes Time and will be billed bi-weekly on Mondays.</span></span>
- <span data-ttu-id="c3460-117">Счета за понесенные расходы должны выставляться ежемесячно в первый понедельник каждого месяца.</span><span class="sxs-lookup"><span data-stu-id="c3460-117">Expenses incurred that need to be billed monthly on the first Monday of each month.</span></span>

<span data-ttu-id="c3460-118">Графики выставления счетов, определенные для каждой из этих двух позиций, выглядят как в следующей таблице:</span><span class="sxs-lookup"><span data-stu-id="c3460-118">Invoice schedules defined on each of these two line items look like the following table:</span></span>

| <span data-ttu-id="c3460-119">Строка контракта</span><span class="sxs-lookup"><span data-stu-id="c3460-119">Contract line</span></span> | <span data-ttu-id="c3460-120">Дата прогона счета</span><span class="sxs-lookup"><span data-stu-id="c3460-120">Invoice run date</span></span> | <span data-ttu-id="c3460-121">Дата прерывания проводки</span><span class="sxs-lookup"><span data-stu-id="c3460-121">Transaction cut-off date</span></span> | <span data-ttu-id="c3460-122">Дата вехи</span><span class="sxs-lookup"><span data-stu-id="c3460-122">Milestone date</span></span> | <span data-ttu-id="c3460-123">Сумма вехи</span><span class="sxs-lookup"><span data-stu-id="c3460-123">Milestone amount</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="c3460-124">Работа по созданию прототипа</span><span class="sxs-lookup"><span data-stu-id="c3460-124">Prototype work</span></span> | <span data-ttu-id="c3460-125">5 октября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-125">October 5, Monday</span></span> | - | <span data-ttu-id="c3460-126">5 октября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-126">October 5, Monday</span></span> | <span data-ttu-id="c3460-127">5000 USD</span><span class="sxs-lookup"><span data-stu-id="c3460-127">5000 USD</span></span> |
| - | <span data-ttu-id="c3460-128">3 ноября, вторник</span><span class="sxs-lookup"><span data-stu-id="c3460-128">November 3, Tuesday</span></span> | - | <span data-ttu-id="c3460-129">3 ноября, вторник</span><span class="sxs-lookup"><span data-stu-id="c3460-129">November 3, Tuesday</span></span> | <span data-ttu-id="c3460-130">12,000 USD</span><span class="sxs-lookup"><span data-stu-id="c3460-130">12,000 USD</span></span> |
| <span data-ttu-id="c3460-131">Работа по реализации</span><span class="sxs-lookup"><span data-stu-id="c3460-131">Implementation work</span></span> | <span data-ttu-id="c3460-132">5 октября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-132">October 5, Monday</span></span> | <span data-ttu-id="c3460-133">4 октября, воскресенье</span><span class="sxs-lookup"><span data-stu-id="c3460-133">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="c3460-134">19 октября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-134">October 19, Monday</span></span> | <span data-ttu-id="c3460-135">18 октября, воскресенье</span><span class="sxs-lookup"><span data-stu-id="c3460-135">October 18, Sunday</span></span> | - | - |
| - | <span data-ttu-id="c3460-136">2 ноября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-136">November 2, Monday</span></span> | <span data-ttu-id="c3460-137">1 ноября, воскресенье</span><span class="sxs-lookup"><span data-stu-id="c3460-137">November 1, Sunday</span></span> | - | - |
| - | <span data-ttu-id="c3460-138">16 ноября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-138">November 16, Monday</span></span> | <span data-ttu-id="c3460-139">15 ноября, воскресенье</span><span class="sxs-lookup"><span data-stu-id="c3460-139">November 15, Sunday</span></span> | - | - |
| <span data-ttu-id="c3460-140">Понесенные расходы</span><span class="sxs-lookup"><span data-stu-id="c3460-140">Expenses incurred</span></span> | <span data-ttu-id="c3460-141">5 октября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-141">October 5, Monday</span></span> | <span data-ttu-id="c3460-142">4 октября, воскресенье</span><span class="sxs-lookup"><span data-stu-id="c3460-142">October 4, Sunday</span></span> | - | - |
| - | <span data-ttu-id="c3460-143">2 ноября, понедельник</span><span class="sxs-lookup"><span data-stu-id="c3460-143">November 2, Monday</span></span> | <span data-ttu-id="c3460-144">1 ноября, воскресенье</span><span class="sxs-lookup"><span data-stu-id="c3460-144">November 1, Sunday</span></span> | - | - |

<span data-ttu-id="c3460-145">В этом примере, когда выполняется автоматическое выставление счетов:</span><span class="sxs-lookup"><span data-stu-id="c3460-145">In this example when the automatic invoicing runs on:</span></span>

- <span data-ttu-id="c3460-146">**4 октября или любое другое число раньше**: для этого контракта не создается счет, потому что в таблице **График выставления счетов** для каждой из этих строк контракта 4 октября, воскресенье, не указывается в качестве даты выставления счета.</span><span class="sxs-lookup"><span data-stu-id="c3460-146">**October 4 or any date before**: No invoice is generated for this contract because the **Invoice Schedule** table for each of these contract lines doesn't call out October 4, Sunday as an invoice run date.</span></span>
- <span data-ttu-id="c3460-147">**5 октября, понедельник**: один счет создается для:</span><span class="sxs-lookup"><span data-stu-id="c3460-147">**October 5 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="c3460-148">Работа по созданию прототипа, включающая веху, если она помечена как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-148">Prototype work that includes the milestone, if it is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="c3460-149">Работа по внедрению, которая включает в себя все транзакции типа "Время", созданные до даты отсечки транзакции 4 октября, воскресенье, которые помечены как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-149">Implementation work that includes all Time transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="c3460-150">Понесенные расходы, которые включают в себя все транзакции типа "Расходы", созданные до даты отсечки транзакции 4 октября, воскресенье, которые помечены как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-150">Expense incurred that includes all Expense transactions created before the transaction cut-off date of October 4, Sunday, that is marked as **Ready to Invoice**.</span></span>
  
- <span data-ttu-id="c3460-151">**6 октября или любое другое число до 19 октября**: для этого контракта не создается счет, потому что в таблице **График выставления счетов** для каждой из этих строк контракта не указывается 6 октября или любая дата до 19 октября в качестве даты выставления счета.</span><span class="sxs-lookup"><span data-stu-id="c3460-151">**On October 6 or any date before October 19**: No invoice is generated for this contract since the **Invoice Schedule** table for each of these contract lines does not call out October 6 or any date before October 19 as an invoice run date.</span></span>
- <span data-ttu-id="c3460-152">**19 октября, понедельник**: один счет создается за работу по внедрению, которая включает в себя все транзакции типа "Время", созданные до даты отсечки транзакции 18 октября, воскресенье, которые помечены как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-152">**October 19, Monday**: One invoice is generated for implementation work that includes all Time transactions created before the transaction cut-off date of October 18, Sunday, that is marked as **Ready to Invoice**.</span></span>
- <span data-ttu-id="c3460-153">**2 ноября, понедельник**: один счет создается для:</span><span class="sxs-lookup"><span data-stu-id="c3460-153">**November 2 Monday**: One invoice is generated for:</span></span>

    - <span data-ttu-id="c3460-154">Работа по внедрению, которая включает в себя все транзакции типа "Время", созданные до даты отсечки транзакции 1 ноября, воскресенье, которые помечены как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-154">Implementation work that includes all Time transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>
    - <span data-ttu-id="c3460-155">Понесенные расходы, которые включают в себя все транзакции типа "Расходы", созданные до даты отсечки транзакции 1 ноября, воскресенье, которые помечены как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-155">Expense incurred that includes all Expense transactions created before the transaction cut-off date of November 1, Sunday, that is marked as **Ready to Invoice**.</span></span>

- <span data-ttu-id="c3460-156">**3 ноября, вторник**: один счет создается за работу по созданию прототипа, которая включает веху для 12 000 долларов США, если она помечена как **Готово к выставлению счета**.</span><span class="sxs-lookup"><span data-stu-id="c3460-156">**November 3, Tuesday**: One invoice is generated for prototype work that includes the milestone for 12000 USD, if it is marked as **Ready to Invoice**.</span></span>

## <a name="configure-automatic-invoicing"></a><span data-ttu-id="c3460-157">Настройка автоматического выставления счетов</span><span class="sxs-lookup"><span data-stu-id="c3460-157">Configure automatic invoicing</span></span>

<span data-ttu-id="c3460-158">Выполните следующие шаги для настройки автоматического запуска выставления счетов.</span><span class="sxs-lookup"><span data-stu-id="c3460-158">Complete the following steps to configure an automated invoice run.</span></span>

1. <span data-ttu-id="c3460-159">В **Project Operations** перейдите в раздел **Параметры** > **Настройка повторяющихся счетов**.</span><span class="sxs-lookup"><span data-stu-id="c3460-159">In **Project Operations**, go to **Settings** > **Recurring Invoice Setup**.</span></span>
2. <span data-ttu-id="c3460-160">Создайте пакетное задание и назовите его **Создание счетов в Project Operations**.</span><span class="sxs-lookup"><span data-stu-id="c3460-160">Create a batch job, and name it **rPoject Operations Create Invoices**.</span></span> <span data-ttu-id="c3460-161">Имя пакетного задания должно включать слова "создание счетов".</span><span class="sxs-lookup"><span data-stu-id="c3460-161">The name of the batch job must include the words, "create invoices".</span></span>
3. <span data-ttu-id="c3460-162">В поле **Тип задания** выберите **Нет**.</span><span class="sxs-lookup"><span data-stu-id="c3460-162">In the **Job Type** field, select **None**.</span></span> <span data-ttu-id="c3460-163">По умолчанию для полей **Частота ежедневно** и **Активно** задано значение **Да**.</span><span class="sxs-lookup"><span data-stu-id="c3460-163">By default, the **Frequency Daily** and **Is Active** fields are set to **Yes**.</span></span>
4. <span data-ttu-id="c3460-164">Выберите **Запустить рабочий процесс**.</span><span class="sxs-lookup"><span data-stu-id="c3460-164">Select **Run Workflow**.</span></span> <span data-ttu-id="c3460-165">В диалоговом окне **Поиск в записях** отображаются три рабочих процесса:</span><span class="sxs-lookup"><span data-stu-id="c3460-165">In the **Look Up Record** dialog box, you will see three workflows:</span></span>

- <span data-ttu-id="c3460-166">ProcessRunCaller</span><span class="sxs-lookup"><span data-stu-id="c3460-166">ProcessRunCaller</span></span>
- <span data-ttu-id="c3460-167">ProcessRunner</span><span class="sxs-lookup"><span data-stu-id="c3460-167">ProcessRunner</span></span>
- <span data-ttu-id="c3460-168">UpdateRoleUtilization</span><span class="sxs-lookup"><span data-stu-id="c3460-168">UpdateRoleUtilization</span></span>

5. <span data-ttu-id="c3460-169">Выберите **ProcessRunCaller**, затем выберите **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="c3460-169">Select **ProcessRunCaller**, and then select **Add**.</span></span>
6. <span data-ttu-id="c3460-170">В следующем диалоговом окне выберите **ОК**.</span><span class="sxs-lookup"><span data-stu-id="c3460-170">In the next dialog box, select **OK**.</span></span> <span data-ttu-id="c3460-171">За рабочим процессом **Сон** следует рабочий процесс **Обработка**.</span><span class="sxs-lookup"><span data-stu-id="c3460-171">A **Sleep** workflow is followed by a **Process** workflow.</span></span> 

> [!NOTE]
> <span data-ttu-id="c3460-172">Можно также выбрать **ProcessRunner** на шаге 5.</span><span class="sxs-lookup"><span data-stu-id="c3460-172">You can also select **ProcessRunner** in step 5.</span></span> <span data-ttu-id="c3460-173">Затем при выборе **OK** за рабочим процессом **Обработка** следует рабочий процесс **Сон**.</span><span class="sxs-lookup"><span data-stu-id="c3460-173">Then, when you select **OK**, a **Process** workflow is followed by a **Sleep** workflow.</span></span>

<span data-ttu-id="c3460-174">Рабочие процессы **ProcessRunCaller** и **ProcessRunner** создают счета.</span><span class="sxs-lookup"><span data-stu-id="c3460-174">The **ProcessRunCaller** and **ProcessRunner** workflows create invoices.</span></span> <span data-ttu-id="c3460-175">**ProcessRunCaller** вызывает **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="c3460-175">**ProcessRunCaller** calls **ProcessRunner**.</span></span> <span data-ttu-id="c3460-176">Счета фактически создаются рабочим процессом **ProcessRunner**.</span><span class="sxs-lookup"><span data-stu-id="c3460-176">**ProcessRunner** is the workflow that actually creates the invoices.</span></span> <span data-ttu-id="c3460-177">Рабочий процесс перебирает все строки контракта, для которых должны быть созданы счета, и создает счета для этих строк.</span><span class="sxs-lookup"><span data-stu-id="c3460-177">The workflow goes through all the contract lines that invoices must be created for, and creates invoices for those lines.</span></span> <span data-ttu-id="c3460-178">Чтобы определить строки контракта, для которых должны быть созданы счета, задание проверяет даты запуска счетов для строк контракта.</span><span class="sxs-lookup"><span data-stu-id="c3460-178">To determine the contract lines that invoices must be created for, the job looks at invoice run dates for the contract lines.</span></span> <span data-ttu-id="c3460-179">Если строки контракта, принадлежащие к одному контракту, имеют одинаковую дату запуска счета, транзакции объединяются в один счет с двумя строками счета.</span><span class="sxs-lookup"><span data-stu-id="c3460-179">If contract lines that belong to one contract have the same invoice run date, the transactions are combined into one invoice that has two invoice lines.</span></span> <span data-ttu-id="c3460-180">Если транзакции, для которых требуется создать счета, отсутствуют, задание пропускает создание счета.</span><span class="sxs-lookup"><span data-stu-id="c3460-180">If there are no transactions to create invoices for, the job skips creating an invoice.</span></span>

<span data-ttu-id="c3460-181">После завершения работы **ProcessRunner** он вызывает **ProcessRunCaller**, предоставляет время завершения и закрывается.</span><span class="sxs-lookup"><span data-stu-id="c3460-181">After **ProcessRunner** has finished running, it calls **ProcessRunCaller**, provides the end time, and is closed.</span></span> <span data-ttu-id="c3460-182">**ProcessRunCaller** затем запускает таймер, который работает 24 часа с указанного времени завершения.</span><span class="sxs-lookup"><span data-stu-id="c3460-182">**ProcessRunCaller** then starts a timer that runs for 24-hours from the specified end time.</span></span> <span data-ttu-id="c3460-183">По завершении работы таймера процесс **ProcessRunCaller** закрывается.</span><span class="sxs-lookup"><span data-stu-id="c3460-183">At the end of the timer, **ProcessRunCaller** is closed.</span></span>

<span data-ttu-id="c3460-184">Задание пакетной обработки для создания счетов — это повторяющееся задание.</span><span class="sxs-lookup"><span data-stu-id="c3460-184">The batch process job for creating invoices is a recurrent job.</span></span> <span data-ttu-id="c3460-185">Если это процесс пакетной обработки запускается много раз, создается несколько экземпляров задания, что вызывает ошибки.</span><span class="sxs-lookup"><span data-stu-id="c3460-185">If this batch process is run many times, multiple instances of the job are created and causes errors.</span></span> <span data-ttu-id="c3460-186">Следовательно, необходимо запустить пакетный процесс только один раз, и затем заново запускать его только в том случае, если он перестал работать.</span><span class="sxs-lookup"><span data-stu-id="c3460-186">Therefore, you should start the batch process only one time, and then restart only if it stops running.</span></span>

> [!NOTE]
> <span data-ttu-id="c3460-187">Пакетное выставление счетов в Project Operations запускается только для строк контракта по проекту, которые настроены с помощью графиков счетов.</span><span class="sxs-lookup"><span data-stu-id="c3460-187">Batch invoicing in Project Operations only runs for project contract lines that are configured by invoice schedules.</span></span> <span data-ttu-id="c3460-188">В строке контракта с методом выставления счетов с фиксированной ценой должны быть настроены вехи.</span><span class="sxs-lookup"><span data-stu-id="c3460-188">A contract line with a fixed price billing method must have milestones configured.</span></span> <span data-ttu-id="c3460-189">Для строки контракта по проекту с методом выставления счетов с учетом времени и материала потребуется настроить расписание счетов на основе даты.</span><span class="sxs-lookup"><span data-stu-id="c3460-189">A project contract line with a time and material billing method will need a date-based invoice schedule set up.</span></span>


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
