---
title: Настройка автоматического создания счетов
description: В этой статье представлены инструкции по установке и настройке автоматического создания счетов-проформ.
author: rumant
ms.date: 04/05/2021
ms.topic: article
ms.reviewer: johnmichalak
ms.author: rumant
ms.openlocfilehash: c5160b22bd0d8a738c31a5105d83bd15cf136fab
ms.sourcegitcommit: 6cfc50d89528df977a8f6a55c1ad39d99800d9b4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8911750"
---
# <a name="set-up-automatic-invoice-creation"></a>Настройка автоматического создания счетов 
 
_**Относится к:** Облегченное развертывание — от сделки до счетов-проформ, Project Operations для сценариев на основе ресурсов/нескладируемых запасов_

Вы можете настроить автоматическое создание счетов в Dynamics 365 Project Operations. Система создает черновик счета-проформы на основе графика счетов для каждого контракта по проекту и строки контракта. Графики выставления счетов настраиваются на уровне строки контракта. Каждая строка в контракте может иметь отдельный график счетов, или один и тот же график счетов может быть включен в каждую строку контракта.

При создании счета система всегда создает как минимум один счет для каждого контракта по проекту. В некоторых случаях может быть создано несколько счетов. Например, если в контракте указано несколько клиентов, будет создано такое же количество счетов, как и количество клиентов, у которых есть оплачиваемые транзакции для выставления счетов по этому контракту по проекту.

## <a name="understand-how-transactions-are-included-on-an-invoice"></a>Сведения о том, как транзакции включаются в счет 

Иногда для каждой строки контракта на основе проекта указывается отдельный график выставления счетов. Например, услуги по реализации для контракта Adatum включают следующие строки контракта:

- Работа по созданию прототипа по фиксированной цене с двумя вехами, созданными вручную.
- Счета за работу по реализации, включающие время, будут выставляться раз в две недели по понедельникам.
- Счета за понесенные расходы должны выставляться ежемесячно в первый понедельник каждого месяца.

Графики выставления счетов, определенные для каждой из этих двух позиций, выглядят как в следующей таблице:

| Строка контракта | Дата прогона счета | Дата прерывания проводки | Дата вехи | Сумма вехи |
| --- | --- | --- | --- | --- |
| Работа по созданию прототипа | 5 октября, понедельник | - | 5 октября, понедельник | 5000 USD |
| - | 3 ноября, вторник | - | 3 ноября, вторник | 12,000 USD |
| Работа по реализации | 5 октября, понедельник | 4 октября, воскресенье | - | - |
| - | 19 октября, понедельник | 18 октября, воскресенье | - | - |
| - | 2 ноября, понедельник | 1 ноября, воскресенье | - | - |
| - | 16 ноября, понедельник | 15 ноября, воскресенье | - | - |
| Понесенные расходы | 5 октября, понедельник | 4 октября, воскресенье | - | - |
| - | 2 ноября, понедельник | 1 ноября, воскресенье | - | - |

В этом примере, когда выполняется автоматическое выставление счетов:

- **4 октября или любое другое число раньше**: для этого контракта не создается счет, потому что в таблице **График выставления счетов** для каждой из этих строк контракта 4 октября, воскресенье, не указывается в качестве даты выставления счета.
- **5 октября, понедельник**: один счет создается для:

    - Работа по созданию прототипа, включающая веху, если она помечена как **Готово к выставлению счета**.
    - Работа по внедрению, которая включает в себя все транзакции типа "Время", созданные до даты отсечки транзакции 4 октября, воскресенье, которые помечены как **Готово к выставлению счета**.
    - Понесенные расходы, которые включают в себя все транзакции типа "Расходы", созданные до даты отсечки транзакции 4 октября, воскресенье, которые помечены как **Готово к выставлению счета**.
  
- **6 октября или любое другое число до 19 октября**: для этого контракта не создается счет, потому что в таблице **График выставления счетов** для каждой из этих строк контракта не указывается 6 октября или любая дата до 19 октября в качестве даты выставления счета.
- **19 октября, понедельник**: один счет создается за работу по внедрению, которая включает в себя все транзакции типа "Время", созданные до даты отсечки транзакции 18 октября, воскресенье, которые помечены как **Готово к выставлению счета**.
- **2 ноября, понедельник**: один счет создается для:

    - Работа по внедрению, которая включает в себя все транзакции типа "Время", созданные до даты отсечки транзакции 1 ноября, воскресенье, которые помечены как **Готово к выставлению счета**.
    - Понесенные расходы, которые включают в себя все транзакции типа "Расходы", созданные до даты отсечки транзакции 1 ноября, воскресенье, которые помечены как **Готово к выставлению счета**.

- **3 ноября, вторник**: один счет создается за работу по созданию прототипа, которая включает веху для 12 000 долларов США, если она помечена как **Готово к выставлению счета**.

## <a name="configure-automatic-invoicing"></a>Настройка автоматического выставления счетов

Выполните следующие шаги для настройки автоматического запуска выставления счетов.

1. В **Project Operations** перейдите в раздел **Параметры** > **Настройка повторяющихся счетов**.
2. Создайте пакетное задание и назовите его **Создание счетов в Project Operations**. Имя пакетного задания должно включать слова "создание счетов".
3. В поле **Тип задания** выберите **Нет**. По умолчанию для полей **Частота ежедневно** и **Активно** задано значение **Да**.
4. Выберите **Запустить рабочий процесс**. В диалоговом окне **Поиск в записях** отображаются три рабочих процесса:

- ProcessRunCaller
- ProcessRunner
- UpdateRoleUtilization

5. Выберите **ProcessRunCaller**, затем выберите **Добавить**.
6. В следующем диалоговом окне выберите **ОК**. За рабочим процессом **Сон** следует рабочий процесс **Обработка**. 

> [!NOTE]
> Можно также выбрать **ProcessRunner** на шаге 5. Затем при выборе **OK** за рабочим процессом **Обработка** следует рабочий процесс **Сон**.

Рабочие процессы **ProcessRunCaller** и **ProcessRunner** создают счета. **ProcessRunCaller** вызывает **ProcessRunner**. Счета фактически создаются рабочим процессом **ProcessRunner**. Рабочий процесс перебирает все строки контракта, для которых должны быть созданы счета, и создает счета для этих строк. Чтобы определить строки контракта, для которых должны быть созданы счета, задание проверяет даты запуска счетов для строк контракта. Если строки контракта, принадлежащие к одному контракту, имеют одинаковую дату запуска счета, транзакции объединяются в один счет с двумя строками счета. Если транзакции, для которых требуется создать счета, отсутствуют, задание пропускает создание счета.

После завершения работы **ProcessRunner** он вызывает **ProcessRunCaller**, предоставляет время завершения и закрывается. **ProcessRunCaller** затем запускает таймер, который работает 24 часа с указанного времени завершения. По завершении работы таймера процесс **ProcessRunCaller** закрывается.

Задание пакетной обработки для создания счетов — это повторяющееся задание. Если это процесс пакетной обработки запускается много раз, создается несколько экземпляров задания, что вызывает ошибки. Следовательно, необходимо запустить пакетный процесс только один раз, и затем заново запускать его только в том случае, если он перестал работать.

> [!NOTE]
> Пакетное выставление счетов в Project Operations запускается только для строк контракта по проекту, которые настроены с помощью графиков счетов. В строке контракта с методом выставления счетов с фиксированной ценой должны быть настроены вехи. Для строки контракта по проекту с методом выставления счетов с учетом времени и материала потребуется настроить расписание счетов на основе даты.


[!INCLUDE[footer-include](../../includes/footer-banner.md)]
