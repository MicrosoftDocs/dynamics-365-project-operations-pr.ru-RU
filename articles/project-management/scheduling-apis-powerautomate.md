---
title: Использование API расписания проекта с Power Automate
description: Эта статья представляет собой пример потока, который использует программные интерфейсы (API) расписания проекта.
author: ruhercul
ms.date: 01/26/2022
ms.topic: article
ms.reviewer: johnmichalak
ms.author: ruhercul
ms.openlocfilehash: 2527375ff3f3d631f3bb3de1458abb3b8838db54
ms.sourcegitcommit: 6cfc50d89528df977a8f6a55c1ad39d99800d9b4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2022
ms.locfileid: "8916350"
---
# <a name="use-project-schedule-apis-with-power-automate"></a>Использование API расписания проекта с Power Automate

_**Относится к:** Project Operations для сценариев на основе ресурсов/нескладируемых запасов, упрощенное развертывание — от сделки до выставления счетов-фактур_

В этой статье описывается пример потока, который показывает, как создать полный план проекта с помощью Microsoft Power Automate, как создать набор операций и как обновить сущность. Пример демонстрирует, как создать проект, участника проектной группы, наборы операций, задачи проекта и назначения ресурсов. В этой статье также объясняется, как обновить сущность и выполнить набор операций.

Ниже приведен полный список шагов, задокументированных в примере потока в этой статье:

1. [Создание триггера PowerApps](#1)
2. [Создание проекта](#2)
3. [Инициализация переменной для участника рабочей группы](#3)
4. [Создание универсального участника рабочей группы](#4)
5. [Создание набора операций](#5)
6. [Создание группы проекта](#6)
7. [Инициализация переменной для состояния ссылки](#7)
8. [Инициализация переменной для количества задач](#8)
9. [Инициализация переменной для ИД задачи проекта](#9)
10. [Цикл "Выполнять до"](#10)
11. [Задание задачи проекта](#11)
12. [Создание задачи проекта](#12)
13. [Создание назначения ресурса](#13)
14. [Уменьшение переменной на 1](#14)
15. [Переименование задачи проекта](#15)
16. [Выполнение набора операций](#16)

## <a name="assumptions"></a>Предположения

Эта статья предполагает, что у вас есть базовые знания о платформе Dataverse, облачных потоках и программном интерфейсе (API) расписания проекта. Дополнительные сведения см. в разделе [Ссылки](#references) далее в этой статье.

## <a name="create-a-flow"></a>Создание потока

### <a name="select-an-environment"></a>Выберите среду

Вы можете создать поток Power Automate в своей среде.

1. Перейдите на страницу <https://flow.microsoft.com> и выполните вход с учетными данными администратора.
2. Выберите **Среды** в правом верхнем углу.
3. В списке выберите среду, в которой установлено приложение Dynamics 365 Project Operations.

### <a name="create-a-solution"></a>Создание решения

Чтобы создать поток, [связанный с решением](/power-automate/overview-solution-flows), выполните описанные ниже действия. Создание потока, связанного с решением, упрощает его экспорт для дальнейшего использования.

1. В области навигации выберите **Решения**.
2. На странице **Решения** выберите **Новое решение**.
3. В диалоговом окне **Новое решение** заполните обязательные поля, затем выберите **OK**.

## <a name="step-1-create-a-powerapps-trigger"></a><a id="1"></a>Шаг 1. Создание триггера PowerApps

1. На странице **Решения** выберите созданное решение, а затем выберите **Создать**.
2. На левой панели выберите **Облачные потоки** \> **Автоматизация** \> **Облачный поток** \> **Мгновенный**.
3. В поле **Имя потока** введите **Демонстрационный поток для API расписания**.
4. В списке **Выберите способ запуска для этого потока** выберите **Power Apps**. При создании триггера Power Apps логику целиком определяете вы как автор. В этой статье оставьте входные параметры пустыми для целей тестирования.
5. Выберите **Создать**.

## <a name="step-2-create-a-project"></a><a id="2"></a>Шаг 2. Создание проекта

Выполните следующие действия, чтобы создать пример проекта.

1. В созданном потоке выберите **Новый шаг**.

    ![Добавление нового шага.](media/newstep.png)

2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.

    ![Выбор операции.](media/chooseactiontab.png)

3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.

![Переименование шага.](media/renamestep.png)

4. Переименуйте шаг в **Создание проекта**.
5. В поле **Имя действия** выберите **msdyn\_CreateProjectV1**.
6. Под полем **msdyn\_subject** выберите **Добавить динамическое содержимое**.
7. На вкладке **Выражение** в поле функции введите **Имя проекта - utcNow()**.
8. Выберите **ОК**.

## <a name="step-3-initialize-a-variable-for-the-team-member"></a><a id="3"></a>Шаг 3. Инициализация переменной для участника рабочей группы

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **инициализировать переменную**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Инициализация участника рабочей группы**.
5. В поле **Имя** введите **TeamMemberAction**.
6. В поле **Тип** выберите **Строка**.
7. В поле **Значение** введите **msdyn\_CreateTeamMemberV1**.

## <a name="step-4-create-a-generic-team-member"></a><a id="4"></a>Шаг 4. Создание универсального участника рабочей группы

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Создание участника рабочей группы**.
5. Для поля **Имя действия** выберите **TeamMemberAction** в диалоговом окне **Динамическое содержимое**.
6. В поле **Параметры действия** введите следующую информацию для параметров.

    ```
    {
        "TeamMember": {
            "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_projectteam",
            "msdyn_projectteamid": "@{guid()}",
            "msdyn_project@odata.bind": "/msdyn_projects(@{outputs('Create_Project')?['body/ProjectId']})",
            "msdyn_name": "ScheduleAPIDemoTM1"
        }
    } 
    ```

    Что представляют собой параметры:

    - **\@\@odata.type** — имя сущности. Например, введите **"Microsoft.Dynamics.CRM.msdyn\_projectteam"**.
    - **msdyn\_projectteamid** — первичный ключ идентификатора проектной группы. Значение представляет собой выражение глобального уникального идентификатора (GUID).   Идентификатор генерируется на вкладке выражения.

    - **msdyn\_project\@odata.bind** — ИД проекта соответствующего проекта. Значением будет динамическое содержимое, полученное из ответа шага "Создание проекта". Убедитесь, что вы ввели полный путь и добавили динамическое содержимое в скобках. Кавычки обязательны. Например, введите **"/msdyn\_projects(ДОБАВЬТЕ ДИНАМИЧЕСКОЕ СОДЕРЖИМОЕ)"**.
    - **msdyn\_name** — имя участника рабочей группы. Например, введите **"ScheduleAPIDemoTM1"**.

## <a name="step-5-create-an-operation-set"></a><a id="5"></a>Шаг 5. Создание набора операций

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Создание набора операций**.
5. В поле **Имя действия** выберите пользовательское действие Dataverse **msdyn\_CreateOperationSetV1**.
6. В поле **Описание** введите **ScheduleAPIDemoOperationSet**.
7. В поле **Проект** введите **/msdyn\_projects(**.
8. В поле **Динамическое содержимое** выберите **msdyn\_CreateProjectV1Response ProjectId**.
9. В поле **Проект** введите **)**.

## <a name="step-6-create-a-project-bucket"></a><a id="6"></a>Шаг 6. Создание группы проекта

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **добавить новую строку**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Создание группы**.
5. В поле **Имя таблицы** выберите **Группы проекта**.
6. В поле **Имя** введите **ScheduleAPIDemoBucket1**.
7. Для поля **Проект** выберите **msdyn\_CreateProjectV1Response ProjectId** в диалоговом окне **Динамическое содержимое**.

## <a name="step-7-initialize-a-variable-for-the-link-status"></a><a id="7"></a>Шаг 7. Инициализация переменной для состояния ссылки

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **инициализировать переменную**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Инициализация состояния ссылки**.
5. В поле **Имя** введите **linkstatus**.
6. В поле **Тип** выберите **Целое число**.
7. В поле **Значение** введите **192350000**.

## <a name="step-8-initialize-a-variable-for-the-number-of-tasks"></a><a id="8"></a>Шаг 8. Инициализация переменной для количества задач

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **инициализировать переменную**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Инициализация количества задач**.
5. В поле **Имя** введите **количество задач**.
6. В поле **Тип** выберите **Целое число**.
7. В поле **Значение** введите **5**.

## <a name="step-9-initialize-a-variable-for-the-project-task-id"></a><a id="9"></a>Шаг 9. Инициализация переменной для ИД задачи проекта

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **инициализировать переменную**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Инициализация ИД задачи проекта**.
5. В поле **Имя** введите **количество задач**.
6. В поле **Тип** выберите **Строка**.
7. Для поля **Значение** введите **guid()** в построителе выражений.

## <a name="step-10-do-until"></a><a id="10"></a>Шаг 10. Цикл "выполнять до"

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнять до**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. Установите первое значение в условном операторе равным переменной **количество задач** из диалогового окна **Динамическое содержимое**.
4. В качестве условия выберите **меньше или равно**.
5. Установите второе значение в условном операторе равным **0**.

## <a name="step-11-set-a-project-task"></a><a id="11"></a>Шаг 11. Задание задачи проекта

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **задать переменную**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В новом шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Задание задачи проекта**.
5. В поле **Имя** выберите **msdyn\_projecttaskid**.
6. Для поля **Значение** введите **guid()** в построителе выражений.

## <a name="step-12-create-a-project-task"></a><a id="12"></a>Шаг 12. Создание задачи проекта

Выполните следующие действия, чтобы создать задачу проекта с уникальным идентификатором, принадлежащим к текущему проекту и созданной вами группе проекта.

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Создание задачи проекта**.
5. В поле **Имя действия** выберите **msdyn\_PssCreateV1**.
6. В поле **Сущность** введите следующую информацию для параметров.

    ```
    {
        "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_projecttask",
        "msdyn_projecttaskid": "@{variables('msdyn_projecttaskid')}",
        "msdyn_project@odata.bind": "/msdyn_projects(@{outputs('Create_Project')?['body/ProjectId']})",
        "msdyn_subject": "ScheduleAPIDemoTask1",
        "msdyn_projectbucket@odata.bind": "/msdyn_projectbuckets(@{outputs('Create_Project_Buckets')?['body/msdyn_projectbucketid']})",
        "msdyn_start": "@{addDays(utcNow(), 1)}",
        "msdyn_scheduledstart": "@{utcNow()}",
        "msdyn_scheduledend": "@{addDays(utcNow(), 5)}",
        "msdyn_LinkStatus": "192350000"
    }
    ```

    Что представляют собой параметры:

    - **\@\@odata.type** — имя сущности. Например, введите **"Microsoft.Dynamics.CRM.msdyn\_projecttask"**.
    - **msdyn\_projecttaskid** — уникальный идентификатор задачи. Значение должно быть установлено равным динамической переменной из **msdyn\_projecttaskid**.
    - **msdyn\_project\@odata.bind** — ИД проекта соответствующего проекта. Значением будет динамическое содержимое, полученное из ответа шага "Создание проекта". Убедитесь, что вы ввели полный путь и добавили динамическое содержимое в скобках. Кавычки обязательны. Например, введите **"/msdyn\_projects(ДОБАВЬТЕ ДИНАМИЧЕСКОЕ СОДЕРЖИМОЕ)"**.
    - **msdyn\_subject** — любое имя задачи.
    - **msdyn\_projectbucket\@odata.bind** — группа проекта, содержащая задачи. Значением будет динамическое содержимое, полученное из ответа шага "Создание группы". Убедитесь, что вы ввели полный путь и добавили динамическое содержимое в скобках. Кавычки обязательны. Например, введите **"/msdyn\_projectbuckets(ДОБАВЬТЕ ДИНАМИЧЕСКОЕ СОДЕРЖИМОЕ)"**.
    - **msdyn\_start** — динамическое содержимое для даты начала. Например, завтрашний день будет представлен как **"addDays(utcNow(), 1)"**.
    - **msdyn\_scheduledstart** — запланированная дата начала. Например, завтрашний день будет представлен как **"addDays(utcNow(), 1)"**.
    - **msdyn\_scheduleend** — запланированная дата окончания. Выберите дату в будущем. Например, укажите **"addDays(utcNow(), 5)"**.
    - **msdyn\_LinkStatus** — состояние ссылки. Например, введите **"192350000"**.

7. Для поля **OperationSetId** выберите **msdyn\_CreateOperationSetV1Response** в диалоговом окне **Динамическое содержимое**.

## <a name="step-13-create-a-resource-assignment"></a><a id="13"></a>Шаг 13. Создание назначения ресурса

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Создание назначения**.
5. В поле **Имя действия** выберите **msdyn\_PssCreateV1**.
6. В поле **Сущность** введите следующую информацию для параметров.

    ```
    {
        "@odata.type": "Microsoft.Dynamics.CRM.msdyn_resourceassignment",
        "msdyn_resourceassignmentid": "@{guid()}",
        "msdyn_name": "ScheduleAPIDemoAssign1",
        "msdyn_taskid@odata.bind": "/msdyn_projecttasks(@{variables('msdyn_projecttaskid')})",
        "msdyn_projectteamid@odata.bind": "/msdyn_projectteams(@{outputs('Create_Team_Member')?['body/TeamMemberId']})",
        "msdyn_projectid@odata.bind": "/msdyn_projects(@{outputs('Create_Project')?['body/ProjectId']})"
    }
    ```

7. Для поля **OperationSetId** выберите **msdyn\_CreateOperationSetV1Response** в диалоговом окне **Динамическое содержимое**.

## <a name="step-14-decrement-a-variable"></a><a id="14"></a>Шаг 14. Уменьшение переменной на 1

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **уменьшить переменную**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В поле **Имя** выберите **количество задач**.
4. В поле **Значение** введите **1**.

## <a name="step-15-rename-a-project-task"></a><a id="15"></a>Шаг 15. Переименование задачи проекта

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Переименование задачи проекта**.
5. В поле **Имя действия** выберите **msdyn\_PssUpdateV1**.
6. В поле **Сущность** введите следующую информацию для параметров.

    ```
    {
        "@@odata.type": "Microsoft.Dynamics.CRM.msdyn_projecttask",
        "msdyn_projecttaskid": "@{variables('msdyn_projecttaskid')}",
        "msdyn_subject": "ScheduleDemoTask1-UpdatedName"
    }
    ```

7. Для поля **OperationSetId** выберите **msdyn\_CreateOperationSetV1Response** в диалоговом окне **Динамическое содержимое**.

## <a name="step-16-run-an-operation-set"></a><a id="16"></a>Шаг 16. Выполнение набора операций

1. В потоке выберите **Новый шаг**.
2. В диалоговом окне **Выберите операцию** в поле поиска введите **выполнить несвязанное действие**. Затем на вкладке **Действия** выберите операцию в списке результатов.
3. В шаге выберите многоточие (**...**), а затем выберите **Переименовать**.
4. Переименуйте шаг в **Выполнение набора операций**.
5. В поле **Имя действия** выберите **msdyn\_ExecuteOperationSetV1**.
6. Для поля **OperationSetId** выберите **msdyn\_CreateOperationSetV1Response OperationSetId** в диалоговом окне **Динамическое содержимое**.

## <a name="references"></a>Ссылки

- [Обзор способов интеграции потоков с Dataverse — Power Automate](/power-automate/dataverse/overview?WT.mc_id=email)
- [Использование API расписания проекта для выполнения операций с сущностями планирования](schedule-api-preview.md)
- [Обзор облачных потоков — Power Automate](/power-automate/overview-cloud?WT.mc_id=email)
- [Обзор потоков, связанных с решениями — Power Automate](/power-automate/overview-solution-flows?WT.mc_id=email)
