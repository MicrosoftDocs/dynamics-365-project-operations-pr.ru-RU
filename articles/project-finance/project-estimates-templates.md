---
title: Синхронизируйте оценки проекта напрямую из Project Service Automation с Finance and Operations
description: В этой теме описаны шаблоны и базовые задачи, которые используются для синхронизации оценок часов проекта и оценки расходов по проекту непосредственно из Microsoft Dynamics 365 Project Service Automation с Dynamics 365 Finance.
author: KimANelson
manager: AnnBe
ms.date: 07/20/2018
ms.topic: article
ms.prod: ''
ms.service: dynamics-ax-applications
ms.technology: ''
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations
ms.custom: 87983
ms.assetid: d688ce9a-41e3-4ebe-952e-700f8351fbe9
ms.search.region: Global
ms.author: knelson
ms.search.validFrom: 2016-11-28
ms.dyn365.ops.version: AX 7.3.0
ms.openlocfilehash: a24a967d82c2e005e61234d34da8a583b61ff7b1
ms.sourcegitcommit: 8c786230ef2a497280885b827162561776e2eb00
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "3754944"
---
# <a name="synchronize-project-estimates-directly-from-project-service-automation-to-finance-and-operations"></a>Синхронизируйте оценки проекта напрямую из Project Service Automation с Finance and Operations

[!include[banner](../includes/banner.md)]

В этой теме описаны шаблоны и базовые задачи, которые используются для синхронизации оценок часов проекта и оценки расходов по проекту непосредственно из Dynamics 365 Project Service Automation с Dynamics 365 Finance.

> [!NOTE]
> - Интеграция задач проекта, категории транзакций расходов, оценки часов, оценки расходов и блокировка функций доступны в версии 8.0.
> - Интеграция фактических данных по проекту доступна в версии 8.0.1 и последующих версиях.

## <a name="data-flow-for-project-service-automation-to-finance"></a>Поток данных для Project Service Automation в Finance

Решение для интеграции Project Service Automation в Finance использует функцию интеграции данных для синхронизации данных между экземплярами Project Service Automation и Finance. Шаблоны интеграции, доступные с функцией интеграции данных, позволяют передавать данные об оценках часов проекта и оценках расходов по проекту из Project Service Automation в Finance.

На следующем рисунке показано, как данные синхронизируются между Project Service Automation и Finance.

[![Поток данных для интеграции Project Service Automation с Finance](./media/ProjectEstimatesFlow.png)](./media/ProjectEstimatesFlow.png)

## <a name="project-hour-estimates"></a>Оценки часов проекта

### <a name="template-and-tasks"></a>Шаблон и задачи

Чтобы получить доступ к доступным шаблонам, в центре администрирования Microsoft Power Apps выберите **Проекты**, а затем в правом верхнем углу выберите **Создать проект** для выбора общедоступных шаблонов.

Следующий шаблон и базовые задачи используются для синхронизации оценок часов проекта из Project Service Automation в Finance:

- **Название шаблона в интеграции данных:** оценки часов проекта (из PSA в Fin and Ops)
- **Название задач в проекте:**

    - Отношения транзакций
    - Оценки расходов

### <a name="entity-set"></a>Набор сущностей

| Project Service Automation | Финансы                                       |
|----------------------------|-----------------------------------------------|
| Задачи проекта              | Сущность интеграции для оценок часов проекта |

### <a name="entity-flow"></a>Поток сущностей

Оценки часов проекта управляются в Project Service Automation и синхронизируются с Finance как прогнозы часов проекта.

### <a name="prerequisites"></a>Предварительные условия

Перед синхронизацией оценок часов проекта необходимо синхронизировать проекты, задачи проекта и категории транзакций расходов по проекту.

### <a name="power-query"></a>Power Query

В шаблоне оценок часов проекта необходимо использовать Microsoft Power Query для Excel для выполнения следующих задач:

- Установите идентификатор модели прогноза по умолчанию, который будет использоваться, когда интеграция создает новые часовые прогнозы.
- Отфильтруйте любые записи о ресурсах в задаче, которые не смогут интегрироваться в прогнозы часов.
- Отфильтруйте все пустые строки категорий транзакций. Невыполнение этой задачи может привести к неверным прогнозам часов.

#### <a name="set-the-default-forecast-model-id"></a>Задайте идентификатор модели прогноза по умолчанию

Чтобы обновить идентификатор модели прогноза по умолчанию в шаблоне, щелкните стрелку **Сопоставить**, чтобы открыть сопоставление. Затем выберите ссылку **Расширенный запрос и фильтрация**.

- Если вы используете шаблон оценок часов проекта по умолчанию (PSA в Fin and Ops), выберите последнее **Вставленное условие** в списке **Примененные шаги**. В записи **Функция** замените **O\_forecast** на название идентификатора модели прогноза, который следует использовать при интеграции. В шаблоне по умолчанию есть идентификатор модели прогноза из демонстрационных данных.
- Если вы создаете новый шаблон, вы должны добавить этот столбец. В Power Query выберите **Добавить условный столбец** и введите имя нового столбца, например **ModelID**. Введите условие для столбца, где, если задача проекта не равна null, то \<введите идентификатор модели прогноза\>; иначе null.

#### <a name="filter-out-resource-specific-records"></a>Отфильтровать записи по конкретным ресурсам

В шаблоне оценок часов проекта (из PSA в Fin and Ops) есть фильтр по умолчанию, который удаляет все записи, относящиеся к конкретным ресурсам. Если вы создаете свой собственный шаблон, вы должны добавить этот фильтр. Выберите ссылку **Расширенный запрос и фильтрация** для фильтрации в столбце **msdyn\_islinetask**, чтобы были включены только записи **false**.

#### <a name="filter-out-empty-transaction-category-rows"></a>Отфильтруйте пустые строки категорий транзакций

Вы должны добавить фильтр, чтобы удалить все строки с пустыми категориями транзакций. Эта задача требуется независимо от того, используете ли вы шаблон по умолчанию или создаете собственный шаблон. Этот фильтр удаляет все итоговые строки из Project Service Automation, которые могут привести к тому, что прогнозы часов в Finance будут неверными. Выберите ссылку **Расширенный запрос и фильтрация** для фильтрации пустых записей (null) в столбце **msdyn\_transactioncategory\_value**.

### <a name="template-mapping-in-data-integration"></a>Сопоставление шаблонов в интеграции данных

На следующих рисунках показан пример сопоставления задач шаблона в интеграции данных. В сопоставлении отображается информация о полях, которые будут синхронизированы из Project Service Automation в Finance.

[![Сопоставление шаблонов](./media/ProjectHourEstimatesMapping.jpg)](./media/ProjectHourEstimatesMapping.jpg)

## <a name="project-expense-estimates"></a>Оценки расходов по проекту

### <a name="template-and-tasks"></a>Шаблон и задачи

Следующий шаблон и базовые задачи используются для синхронизации оценок расходов по проекту из Project Service Automation в Finance:

- **Название шаблона в интеграции данных:** оценки расходов по проекту (из PSA в Fin and Ops)
- **Название задач в проекте:**

    - Отношения транзакций 
    - Оценки расходов

### <a name="entity-set"></a>Набор сущностей

| Project Service Automation | Финансы                                                  |
|----------------------------|----------------------------------------------------------|
| Подключения проводки    | Сущность интеграции для отношений транзакций проекта |
| Строки оценки             | Сущность интеграции для оценок расходов по проекту         |

### <a name="entity-flow"></a>Поток сущностей

Оценки расходов по проекту управляются в Project Service Automation и синхронизируются с Finance как прогнозы расходов по проекту.

### <a name="prerequisites"></a>Предварительные условия

Перед синхронизацией оценок расходов по проекту необходимо синхронизировать проекты, задачи проекта и категории транзакций расходов по проекту.

### <a name="power-query"></a>Power Query

В шаблоне оценок расходов по проекту необходимо использовать Power Query для выполнения следующих задач:

- Фильтр для включения только записей строк оценки расходов.
- Установите идентификатор модели прогноза по умолчанию, который будет использоваться, когда интеграция создает новые часовые прогнозы.
- Преобразуйте типы выставления счетов.
- Преобразуйте типы транзакций.

#### <a name="filter-to-include-only-expense-estimate-lines"></a>Фильтр для включения только строк оценки расходов

В шаблоне оценок расходов по проекту (из PSA в Fin and Ops) есть фильтр по умолчанию, который включает в интеграцию только строки расходов. Если вы создаете свой собственный шаблон, вы должны добавить этот фильтр. Выберите задачу **Отношений транзакций**, а затем щелкните стрелку **Сопоставление**, чтобы открыть сопоставление. Выберите ссылку **Расширенный запрос и фильтрация**. Отфильтруйте столбец **msdyn\_transactiontype1**, чтобы он включал только **msdyn\_estimateline**.

#### <a name="set-the-default-forecast-model-id"></a>Задайте идентификатор модели прогноза по умолчанию

Чтобы обновить идентификатор модели прогноза по умолчанию в шаблоне, выберите задачу **Оценки расходов** и нажмите стрелку **Сопоставить**, чтобы открыть сопоставление. Выберите ссылку **Расширенный запрос и фильтрация**.

- Если вы используете шаблон оценок расходов по проекту по умолчанию (PSA в Fin and Ops), в Power Query сначала выберите последнее **Вставленное условие** в разделе **Примененные шаги**. В записи **Функция** замените **O\_forecast** на название идентификатора модели прогноза, который следует использовать при интеграции. В шаблоне по умолчанию есть идентификатор модели прогноза из демонстрационных данных.
- Если вы создаете новый шаблон, вы должны добавить этот столбец. В Power Query выберите **Добавить условный столбец** и введите имя нового столбца, например **ModelID**. Введите условие для столбца, где, если идентификатор строки расходов не равен null, то \<введите идентификатор модели прогноза\>; иначе null.

#### <a name="transform-the-billing-types"></a>Преобразуйте типы выставления счетов

Шаблон оценки расходов по проекту (из PSA в Fin and Ops) включает условный столбец, который используется для преобразования типов выставления счетов, получаемых от Project Service Automation во время интеграции. Если вы создаете свой собственный шаблон, вы должны добавить этот условный столбец. Выберите ссылку **Расширенный запрос и фильтрация**, а затем выберите **Добавить условный столбец**. Введите имя для нового столбца, например **BillingType**. Затем введите следующее условие:

Если **msdyn\_billingtype** = 192350000, тогда **NonChargeable**  
иначе **msdyn\_billingtype** = 192350001, тогда **Chargeable**  
иначе **msdyn\_billingtype** = 192350002, тогда **Complimentary**  
иначе **NotAvailable**

#### <a name="transform-the-transaction-types"></a>Преобразуйте типы транзакций

Шаблон оценки расходов по проекту (из PSA в Fin and Ops) включает условный столбец, который используется для преобразования типов транзакций, получаемых от Project Service Automation во время интеграции. Если вы создаете свой собственный шаблон, вы должны добавить этот условный столбец. Выберите ссылку **Расширенный запрос и фильтрация**, а затем выберите **Добавить условный столбец**. Введите имя для нового столбца, например **TransactionType**. Затем введите следующее условие:

Если **msdyn\_transactiontypecode** = 192350000, тогда **Cost**  
иначе, если **msdyn\_transactiontypecode** = 192350005, тогда **Sales**  
иначе **null**

### <a name="template-mapping-in-data-integration"></a>Сопоставление шаблонов в интеграции данных

На следующих рисунках показаны примеры сопоставлений задач шаблона в интеграции данных. В сопоставлении отображается информация о полях, которые будут синхронизированы из Project Service Automation в Finance.

[![Сопоставление шаблонов](./media/ExpenseEstimateTransactionRelationshipsMapping.jpg)](./media/ExpenseEstimateTransactionRelationshipsMapping.jpg)

[![Сопоставление шаблонов](./media/ExpenseEstimatesMapping.jpg)](./media/ExpenseEstimatesMapping.jpg)
