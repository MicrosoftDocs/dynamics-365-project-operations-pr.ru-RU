---
title: Расширение записей времени
description: Эта тема предоставляет информацию о том, как разработчики могут расширить элемент управления ввода времени.
author: stsporen
manager: Annbe
ms.date: 10/01/2020
ms.topic: article
ms.service: dynamics-365-customerservice
ms.reviewer: kfend
ms.author: stsporen
ms.openlocfilehash: 93f411ad7c86beefcc35e7799a03987dacdcd62b
ms.sourcegitcommit: 5a29adce48133e09f051929e8544d6c2c93c025d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2020
ms.locfileid: "3930896"
---
# <a name="extending-time-entries"></a>Расширение записей времени

_**Относится к:** Project Operations для сценариев на основе ресурсов/нескладируемых запасов, упрощенное развертывание — от сделки до выставления счетов-фактур_

Dynamics 365 Project Operations включает расширяемый настраиваемый элемент управления вводом времени. Этот элемент управления включает следующие функции:

- Ввод времени по горизонтали в течение недели
- Итоги за день, строку или неделю
- Копирование строк или недель
- Ввод времени через ЧЧ:мм или ЧЧ,чч (автоматически преобразуется в ЧЧ,чч)
- Импорт из назначений, резервирований или встреч

Расширение записей времени возможно в двух областях:
- [Добавление настраиваемых записей времени для собственного использования](#add)
- [Настройка элемента управления недельной записи времени](#customize)

## <a name="add-custom-time-entries-for-your-own-use"></a><a name="add"></a>Добавьте настраиваемые записи времени для собственного использования.

Записи времени — это основная сущность, которая предназначена для использования в нескольких сценариях. В волне 1 за апрель 2020 года было представлено базовое решение TESA, которое обеспечивает сущность **Параметры** и новую роль безопасности **Пользователь с вводом времени**. Новые поля, **msdyn_start** и **msdyn_end**, которые имеют прямое отношение к **msdyn_duration**, также были включены. Новая сущность, роль безопасности и поля позволяют использовать более унифицированный подход к времени для нескольких продуктов.


### <a name="time-source-entity"></a>Сущность источника времени
| Поле | Описание: | 
|-------|------------|
| Название  | Имя записи источника времени, используемой в качестве значения выбора при создании записи времени. |
| Источник времени по умолчанию [Источник времени: isdefault] | По умолчанию в качестве источника времени может быть отмечен только один источник времени по умолчанию. Эта возможность позволяет записи по умолчанию использовать источник времени, если он не указан. |
|Тип источника времени [Источник времени: sourcetype] | Тип источника — это опция (Тип источника записи времени), которая позволяет связать источник времени с приложением. Дополнительные значения будут добавляться к этому набору параметров по мере добавления дополнительных приложений. Обратите внимание, что Microsoft резервирует значения, превышающие 190 000 000.|


### <a name="time-entries-and-the-time-source-entity"></a>Записи времени и сущность источника времени
Каждая запись времени связана с записью источника времени. Эта запись определяет, как и какие приложения должны обрабатывать запись времени.

Записи времени — это всегда один непрерывный блок времени с привязкой к началу, концу и продолжительности.

Логика автоматически обновит запись времени в следующих ситуациях:

- Если указаны два из трех следующих полей, третье рассчитывается автоматически 

    - **msdyn_start**
    - **msdyn_end**
    - **msdyn_duration**

- Поля **msdyn_start** и **msdyn_end** учитывают часовой пояс.
- Записи времени, созданные только с указанными полями **msdyn_date** и **msdyn_duration**, начинаются в полночь, а **msdyn_start** и **msdyn_end** будут обновлены соответственно.

#### <a name="time-entry-types"></a>Типы записей времени

Записи ввода времени имеют связанный тип, который определяет поведение в потоке отправки для связанного приложения.

|Ярлык | значение|
|-----|-----|
|На перерыве   |192,355,000|
|Поездка | 192,355,001|
|Сверхурочная работа   | 192,354,320|
|На работе   | 192,350,000|
|Отсутствие    | 192,350,001|
|Отпуск   | 192,350,002|



## <a name="customize-the-weekly-time-entry-control"></a><a name="customize"></a>Настройка элемента управления недельной записи времени
Разработчики могут добавлять дополнительные поля и поисковые запросы к другим сущностям, а также реализовывать настраиваемые бизнес-правила для поддержки своих бизнес-сценариев.

### <a name="add-custom-fields-with-lookups-to-other-entities"></a>Добавление пользовательских полей с подстановками в другие сущности
Существует три основных шага для добавления настраиваемого поля в сетку еженедельных записей времени.

- Добавьте настраиваемое поле в диалоговое окно быстрого создания.
- Настройте сетку для отображения настраиваемого поля.
- Добавьте настраиваемое поле в поток задач изменения строки или в поток задач изменения ячейки.

Также следует убедиться, что новое поле имеет необходимые проверки в потоке задач редактирования строки или ячейки. В составе данного шага необходимо заблокировать поле, основываясь на состоянии записи времени.

#### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>Добавьте настраиваемое поле в диалоговое окно быстрого создания
Необходимо добавить настраиваемое поле в диалоговое окно **Быстрое создание записи времени**. Затем пользователи могут ввести значение при добавлении записей времени, выбрав **Создать**.

#### <a name="configure-the-grid-to-show-the-custom-field"></a>Настройте сетку для отображения настраиваемого поля
Существует два способа добавления настраиваемого поля в сетку еженедельных записей времени:

  - Настройка представления и добавление настраиваемого поля
  - Создание новой настраиваемой записи времени по умолчанию 


**Настройка представления и добавление настраиваемого поля**

Можно настроить представление **Мои недельные записи времени** и добавить в него настраиваемое поле. Можно выбрать положение и размер настраиваемого поля в сетке путем редактирование этих свойств в представлении.

**Создание новой настраиваемой записи времени по умолчанию** 

Это представление должно содержать поля **Описание** и **Внешние комментарии**, помимо столбцов, которые должны быть включены в сетку. 

1. Выберите положение, размер и порядок сортировки по умолчанию сетки путем редактирования этих свойств в представлении. 
2. Настройте настраиваемый элемент управления для этого представления, чтобы он был элемент управления **Сетка записей времени**. 
3. Добавить этот элемент управления в представление и выберите его для Интернета, телефона и планшета. 
4. Настройте параметры сетки недельной записи времени. Задайте для поля **Дата начала** значение **msdyn_date**, для поля **Длительность** — значение **msdyn_duration**, а для поля **Состояние** — значение **msdyn_entrystatus**. 
5. Для представления по умолчанию для поля **Список состояний только для чтения** задано значение **192350002,192350003,192350004**, для поля **Поток задач редактирования строки** задано значение **msdyn_timeentryrowedit**, а для поля **Поток задач редактирования ячейки** задано значение **msdyn_timeentryedit**. 
6. Можно настроить эти поля для добавления или удаления состояния только для чтения или для использования другого взаимодействия на основе задач (TBX) для редактирования строк или ячеек. Эти поля должны быть связаны со статическим значением.


> [!NOTE] 
> Оба варианта извлекут некоторую готовую фильтрацию по сущностям **Проект** и **Задача проекта**, чтобы все представления подстановки для этих сущностей были видны. В готовом виде только соответствующие представления подстановки отображаются.
Необходимо определить соответствующий поток задач для настраиваемого поля. Наиболее вероятно, если вы добавили поле в сетку, оно должно идти в поток задач редактирования строки, используемый для полей, которые применяются к целой строке записей времени. Если настраиваемое поле имеет уникальное значение каждый день, например настраиваемое поле **Время окончания**, оно должно быть назначено потоку задач редактирования ячейки.

Для добавления настраиваемого поля в поток задач перетащите элемент **Поле** в нужное положение на странице, затем задайте свойства поля. Задайте для свойства **Источника** значение **Запись времени**, а для свойства **Поле данных** задайте настраиваемое поле. Свойство **Поле** задает отображаемое имя на странице TBX. Выберите **Применять**, чтобы сохранить изменения в поле, затем выберите **Обновить**, чтобы сохранить изменения на странице.

Чтобы использовать вместо этого новую настраиваемую страницу TBX, создайте новый процесс. Задайте категорию **Последовательность операций бизнес-процесса**, задайте сущность **Запись времени** и задайте тип бизнес-процесса **Запускать процесс как поток задач**. В разделе **Свойства** свойство **Имя страницы** должно быть установлено на отображаемое имя для страницы. Добавьте все соответствующие поля на страницу TBX. Сохраните и активируйте процесс, затем обновите свойство настраиваемого элемента управления для соответствующего потока задач на значение **Имя** в процессе.

### <a name="add-new-option-set-values"></a>Добавление новых значений набора параметров
Для добавления значений набора параметров с готовое поле откройте страницу редактирование для поля, затем, в разделе **Тип**, выберите **Изменить** рядом с набором параметров. Далее добавьте новый параметр, имеющий настраиваемую подпись и цвет. Если требуется добавить новое состояние записи времени, готовое поле называется **Состояние записи**, а не **Состояние**.

### <a name="designate-a-new-time-entry-status-as-read-only"></a>Назначение новому состоянию записи времени доступа только для чтения
Чтобы сделать новое состояние записи времени доступным только для чтения, добавьте новое значение записи времени в свойство **Список состояний только для чтения**. Изменяемая часть сетки записи времени будет заблокирована для строк в этом новом состоянии.
Далее, добавьте бизнес-правила, чтобы заблокировать все поля на страницах TBX **Изменение строки записи времени** и **Изменение записи времени**. Можно получить доступ к бизнес-правилам для этих страниц, открыв редактор последовательности операций бизнес-процесса для этой страницы, затем выбрав **Бизнес-правила**. Можно добавить новое состояние в условие в существующих бизнес-правилах или можно добавить новое бизнес-правило для нового состояния.

### <a name="add-custom-validation-rules"></a>Добавление настраиваемых правил проверки
Есть два типа правил проверки, которые вы можете добавить для еженедельной сетки ввода времени:

- Клиентские бизнес-правила, которые работают в диалоговых окнах быстрого создания и на страницах ТВХ.
- Проверки подключаемых модулей на стороне сервера, которые применяются ко всем обновлениям записей времени.

#### <a name="business-rules"></a>Бизнес-правила
Используйте бизнес-правила для блокировки и разблокировки полей, ввода значений по умолчанию в поля и определения проверок, которые требуют информации только из текущей записи ввода времени. Можно получить доступ к бизнес-правилам для страницы TBX, открыв редактор последовательности операций бизнес-процесса для этой страницы, затем выбрав **Бизнес-правила**. Затем можно изменять существующие правила бизнес-правила или добавить новое бизнес-правило. Для еще более настроенных проверок можно использовать бизнес-правило для выполнения кода JavaScript.

#### <a name="plug-in-validations"></a>Подключаемые модули проверки
Необходимо использовать подключаемые модули проверки для любых проверок, для которых требуется больше контекста, чем доступно в одной записи ввода времени, или для любых проверок, которые требуется выполнять при встроенных обновлениях в сетке. Для выполнения проверки создайте настраиваемый подключаемый модуль для сущности **Запись времени**.
