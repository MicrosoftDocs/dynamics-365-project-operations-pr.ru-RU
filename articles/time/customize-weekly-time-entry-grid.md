---
title: Расширение записей времени
description: Эта тема предоставляет информацию о том, как разработчики могут расширить элемент управления ввода времени.
author: stsporen
ms.date: 01/27/2022
ms.topic: article
ms.reviewer: johnmichalak
ms.author: stsporen
ms.openlocfilehash: 6b91aecd76950d2bd37192d634c80ea98d08034e
ms.sourcegitcommit: c0792bd65d92db25e0e8864879a19c4b93efb10c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2022
ms.locfileid: "8583002"
---
# <a name="extending-time-entries"></a>Расширение записей времени

_**Относится к:** Project Operations для сценариев на основе ресурсов/нескладируемых запасов, упрощенное развертывание — от сделки до выставления счетов-фактур_

Dynamics 365 Project Operations включает расширяемый пользовательский элемент управления вводом времени. Этот элемент управления включает следующие функции:

- Ввод времени по горизонтали в течение недели
- Итоги за день, строку или неделю
- Копирование строк или недель
- Ввод времени через ЧЧ:мм или ЧЧ,чч (автоматически преобразуется в ЧЧ,чч)
- Импорт из назначений, резервирований или встреч

Расширение записей времени возможно в двух областях:
- [Добавление настраиваемых записей времени для собственного использования](#add)
- [Настройка элемента управления недельной записи времени](#customize)

## <a name="add-custom-time-entries-for-your-own-use"></a><a name="add"></a>Добавьте настраиваемые записи времени для собственного использования

Записи времени — это основная сущность, используемая во многих сценариях. В волне 1 за апрель 2020 года было представлено базовое решение TESA. TESA предоставляет сущность **Параметры** и новую роль безопасности **Пользователь с вводом времени**. Новые поля, **msdyn_start** и **msdyn_end**, которые имеют прямое отношение к **msdyn_duration**, также были включены. Новая сущность, роль безопасности и поля позволяют использовать более унифицированный подход к времени для нескольких продуктов.


### <a name="time-source-entity"></a>Сущность источника времени
| Поле | Описание: | 
|-------|------------|
| Название  | Имя записи источника времени, используемой в качестве значения выбора при создании записей времени. |
| Источник времени по умолчанию [Источник времени: isdefault] | По умолчанию только один источник времени может быть отмечен как источник времени по умолчанию. Это позволяет записи по умолчанию использовать источник времени, если он не указан. |
|Тип источника времени [Источник времени: sourcetype] | Тип источника — это опция (Тип источника записи времени), которая позволяет связать источник времени с приложением. Microsoft резервирует значения, превышающие 190 000 000.|


### <a name="time-entries-and-the-time-source-entity"></a>Записи времени и сущность источника времени
Каждая запись времени связана с записью источника времени. Эта запись определяет, какие приложения должны обрабатывать запись времени и каким образом.

Записи времени — это всегда один непрерывный блок времени с привязкой к началу, концу и продолжительности.

Логика автоматически обновит запись времени в следующих ситуациях:

- Если указаны два из трех следующих полей, третье рассчитывается автоматически: 

    - **msdyn_start**
    - **msdyn_end**
    - **msdyn_duration**

- Поля **msdyn_start** и **msdyn_end** учитывают часовой пояс.
- Записи времени, созданные только с указанием **msdyn_date** и **msdyn_duration**, начинаются в полночь. Поля **msdyn_start** и **msdyn_end** обновятся соответствующим образом.

#### <a name="time-entry-types"></a>Типы записей времени

Записи ввода времени имеют связанный тип, который определяет поведение в потоке отправки для связанного приложения.

|Ярлык | значение|
|-----|-----|
|На перерыве   |192,355,000|
|Поездка | 192,355,001|
|Сверхурочная работа   | 192,354,320|
|На работе   | 192,350,000|
|Отсутствие    | 192,350,001|
|Отпуск   | 192,350,002|


## <a name="customize-the-weekly-time-entry-control"></a><a name="customize"></a>Настройка элемента управления недельной записи времени
Разработчики могут добавлять дополнительные поля и поисковые запросы к другим сущностям, а также реализовывать настраиваемые бизнес-правила для поддержки своих бизнес-сценариев.

### <a name="add-custom-fields-with-lookups-to-other-entities"></a>Добавление пользовательских полей с подстановками в другие сущности
Существует три основных шага для добавления настраиваемого поля в сетку еженедельных записей времени.

1. Добавьте настраиваемое поле в диалоговое окно **Быстрое создание**.
2. Настройте сетку для отображения настраиваемого поля.
3. Добавьте настраиваемое поле на страницу **Изменение строки** или **Изменение записи времени** соответственно.

Убедитесь, что новое поле имеет необходимые проверки на странице **Изменение строки** или **Изменение записи времени**. В рамках этой задачи необходимо заблокировать поле в зависимости от состояния записи времени.

Когда вы добавляете настраиваемое поле в сетку **Запись времени**, а затем создаете записи времени непосредственно в сетке, значение в настраиваемом поле для этих записей автоматически задается так, чтобы оно соответствовало строке. 

### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>Добавление настраиваемого поля в диалоговое окно "Быстрое создание"
Добавьте настраиваемое поле в диалоговое окно **Быстрое создание: Создание записи времени**. Затем пользователи могут ввести значение при добавлении записей времени, выбрав **Создать**.

### <a name="configure-the-grid-to-show-the-custom-field"></a>Настройте сетку для отображения настраиваемого поля
Существует два способа добавления настраиваемого поля в сетку **Еженедельная запись времени**.

- Настройте представление **Мои недельные записи времени** и добавьте в него настраиваемое поле. Можно указать положение и размер настраиваемого поля в сетке путем редактирования этих свойств в представлении.
- Создайте новое настраиваемое представление записи времени и установите его как представление по умолчанию. Это представление должно содержать поля **Описание** и **Внешние комментарии**, помимо столбцов, которые должны быть включены в сетку. Можно указать положение, размер и порядок сортировки по умолчанию сетки путем редактирования этих свойств в представлении. Далее настройте настраиваемый элемент управления для этого представления, чтобы он был элемент управления **Сетка записей времени**. Добавьте элемент управления в представление и выберите его для **Интернета**, **телефона** и **планшета**. Далее настройте параметры сетки **Еженедельная запись времени**. Задайте для поля **Дата начала** значение **msdyn\_date**, для поля **Длительность** — значение **msdyn\_duration**, а для поля **Состояние** — значение **msdyn\_entrystatus**. Поле **Список состояний только для чтения** устанавливается равным **192350002 (Утверждено)**, **192350003 (Отправлено)** или **192350004 (Запрошен отзыв)**.

### <a name="add-the-custom-field-to-the-appropriate-edit-page"></a>Добавление настраиваемого поля на соответствующую страницу редактирования
Страницы, которые используются для редактирования записи времени или ряда записей времени, находятся в разделе **Формы**. Кнопка **Изменить запись** в сетке открывает страницу **Изменение записи**, а кнопка **Изменить строку** открывает страницу **Изменение строки**. Вы можете редактировать эти страницы, чтобы они включали настраиваемые поля.

В обоих вариантах удаляется часть фильтрации по сущностям **Проект** и **Задача проекта**, чтобы все представления подстановки для этих сущностей были видны. В готовом виде только соответствующие представления подстановки отображаются.

Необходимо определить соответствующую страницу для настраиваемого поля. Наиболее вероятно, если вы добавили поле в сетку, что оно должно быть на странице **Изменение строки**, используемой для полей, которые применяются к целой строке записей времени. Если настраиваемое поле имеет свое значение в строке каждый день (например, если это настраиваемое поле для времени окончания), оно должно быть на странице **Изменение записи времени**.

Для добавления настраиваемого поля на страницу перетащите элемент **Поле** в нужное положение на странице, затем задайте его свойства.

### <a name="add-new-option-set-values"></a>Добавление новых значений набора параметров
Чтобы добавить в стандартое поле значения набора параметров, выполните следующие действия.

1. Откройте страницу редактирование для поля, а затем в разделее **Тип** выберите **Изменить** рядом с набором параметров.
2. Добавьте новый параметр, имеющий настраиваемую подпись и цвет. Если требуется добавить новое состояние записи времени, готовое поле называется **Состояние записи**.

### <a name="designate-a-new-time-entry-status-as-read-only"></a>Назначение новому состоянию записи времени доступа только для чтения
Чтобы сделать новое состояние записи времени доступным только для чтения, добавьте новое значение записи времени в свойство **Список состояний только для чтения**. Обязательно добавляйте номер, а не подпись. Изменяемая часть сетки записи времени теперь будет заблокирована для строк в этом новом состоянии. Чтобы задать свойство **Список состояний только для чтения** по-разному для разных представлений **Запись времени**, добавьте сетку **Запись времени** в раздел **Пользовательские элементы управления** и настройте параметры соответствующим образом.

Далее, добавьте бизнес-правила, чтобы заблокировать все поля на страницах **Изменение строки** и **Изменение записи времени**. Чтобы получить доступ к бизнес-правилам для этих страниц, откройте редактор форм для каждой страницы и выберите **Бизнес правила**. Можно добавить новое состояние в условие в существующих бизнес-правилах или можно добавить новое бизнес-правило для нового состояния.

### <a name="add-custom-validation-rules"></a>Добавление настраиваемых правил проверки
Для сетки **Еженедельная запись времени** можно добавить два типа правил проверки:

- Бизнес-правила на стороне клиента, которые работают на страницах
- Проверки, выполняемые подключаемыми модулями на стороне сервера, которые применяются ко всем обновлениям записей времени

#### <a name="client-side-business-rules"></a>Бизнес-правила на стороне клиента
Используйте бизнес-правила для блокировки и разблокировки полей, ввода значений по умолчанию в поля и определения проверок, которые требуют информации только из текущей записи ввода времени. Чтобы получить доступ к бизнес-правилам для страницы, откройте редактор форм и выберите **Бизнес правила**. Затем можно изменять существующие правила бизнес-правила или добавить новое бизнес-правило.

#### <a name="server-side-plug-in-validations"></a>Проверки, выполняемые подключаемыми модулями на стороне сервера
Для проверок, для которых требуется больше контекста, чем доступно в одной записи ввода времени, следует использовать подключаемые модули. Их также следует использовать для проверок, которые вы хотите выполнять для обновлений в строках в сетке. Для выполнения проверок создайте настраиваемый подключаемый модуль для сущности **Запись времени**.

### <a name="limits"></a>Ограничения
В настоящее время сетка **Запись времени** имеет ограничение по размеру в 500 строк. Если строк больше 500, остальные строки отображаться не будут. Способа увеличить это ограничение нет.

### <a name="copying-time-entries"></a>Копирование записей времени
Используйте представление **Копировать столбцы записи времени** для определения списка полей для копирования во время ввода времени. **Дата** и **Длительность** являются обязательными полями и не должны удаляться из представления.


[!INCLUDE[footer-include](../includes/footer-banner.md)]
