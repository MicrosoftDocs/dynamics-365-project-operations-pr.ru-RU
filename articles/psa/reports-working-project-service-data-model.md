---
title: Работа с моделью данных Project Service Automation
description: В этом разделе представлена информация о том, как работать с моделью данных.
author: ruhercul
ms.custom:
- dyn365-projectservice
ms.date: 03/01/2019
ms.topic: article
ms.author: ruhercul
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.openlocfilehash: 37c7b15daa75cc3ba53ff6a3bcc0ab54717aa62d
ms.sourcegitcommit: 40f68387f594180af64a5e5c748b6efa188bd300
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/10/2021
ms.locfileid: "6008822"
---
# <a name="working-with-the-project-service-automation-data-model"></a>Работа с моделью данных Project Service Automation

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]
[!include [rename-banner](~/includes/cc-data-platform-banner.md)]

Dynamics 365 Project Service Automation расширяет сущности других приложений и вводит собственные сущности в модель данных Common Data Service. В этом разделе описываются некоторые из сущностей, которые вы встретите в типичных сценариях отчетности в PSA.

## <a name="reporting-on-opportunities"></a>Отчеты по возможным сделкам

Project Service Automation расширяет сущность **Возможная сделка** из Dynamics 365 Sales, добавляя поля для поддержки сценариев на основе проектов. Эти поля определяются именем схемы с префиксом **msdyn\_**. Одно новое поле, которое важно для отчета о возможных сделках PSA, это **Тип заказа**. Значение этого поля **На основе работ** указывает, что возможная сделка является возможной сделкой PSA. Другие поля, которые были добавлены к сущности, включают **Контрактная организация**, которое принимает организацию, к которой относится возможная сделка, и **Менеджер по работе с клиентами**, которое принимает имя менеджера по работе с клиентами, отвечающего за возможную сделку.

Сущность **Строка возможной сделки** также содержит поля, связанные с Project Service. **Метод выставления счета** указывает способ выставления счетов по строке возможной сделки: на основе времени и материалов или на основе фиксированной цены; **Проект** содержит имя проекта, лежащего в основе возможное сделки. Другие поля, для которых возможен отчет, фиксируют расходы и суммы бюджета клиента для номенклатуры строки.

## <a name="reporting-on-quotes"></a>Отчетность по предложениям с расценками

PSA расширяет сущность **Предложение с расценками** из Sales, добавляя поля, связанные с проектом. **Тип заказа** различает предложения с расценками PSA от предложений с расценками, не связанных с PSA. Значение этого поля **На основе работ** указывает, что предложение с расценками является предложением с расценками PSA. Другие поля, которые могут иметь отношение к отчетности по предложениям PSA, включают поля сумм, например **Оплачиваемые расходы**, **Неоплачиваемые расходы**, **Валовая прибыль**, **Оценки** и **Бюджет**. Другие полезные поля указывают, является ли предложение с расценками прибыльным, будет ли оно завершено по расписанию и удовлетворяет ли оно ожиданиям бюджета клиента.

Также PSA расширяет сущность **Строка предложения с расценками** из Sales. Одно поле, которое PSA добавляет, называется **Метод выставления счета**, которое указывает, как будут выставляться счета по строке предложения с расценками (время и материалы или фиксированная цена). Другие поля, которые были добавлены к сущности, хранят связанный проект, лежащий в основе строки предложения с расценками, выставление счетов, стоимость и бюджет.

PSA также добавляет новые сущности, связанные с предложением с расценками, в модель данных Dynamics 365. Ниже приведено несколько примеров:

- **Сведения строки предложения с расценками** — данный объект содержит сведения оценки проекта по строке предложения с расценками. Он содержит две записи для каждой строки предложения с расценками. В одной записи хранится стоимость и сведения о стоимости по строке предложения с расценками, а в другой записи хранится сумма продажи и сведения о продаже для строки предложения с расценками.
- **Расписание счета строки предложения с расценками** — данный объект содержит расписание выставления счетов для строки предложения с расценками. Это расписание создается на основе частоты выставления счетов, которая назначена строке предложения с расценками.
- **Веха строки предложения с расценками** — данный объект содержит вехи выставления счетов для строк предложения с расценками с фиксированной ценой.
- **Разбивка аналитики строки предложения с расценками** — данный объект содержит финансовые сведения по строке предложения с расценками. Эти сведения могут быть полезными для отчетности по продажам по предложению с расценками и ожидаемых суммах стоимости по различным аналитикам.

Остальные сущности, которые PSA добавляет в предложения с расценками, это **Прайс-лист проекта для строки предложения с расценками**, **Категория ресурса строки предложения с расценками** и **Категория проводки строки предложения с расценками**.

![Диаграмма с взаимосвязями предложения с расценками, строки предложения с расценками и проекта](media/PS-Reporting-image2.png "Диаграмма с взаимосвязями предложения с расценками, строки предложения с расценками и проекта")

## <a name="reporting-on-project-contracts"></a>Создание отчетов о контрактах по проекту

PSA расширяет сущность **Заказ** из Sales, которая используется при записи контрактов по проекту. Добавляется важное новое поле, **Тип заказа**, которое определяет контракт как контракт по проекту PSA вместо заказа на продажу. Значение этого поля **На основе работ** указывает, что заказ является контрактом по проекту PSA. Другие новые поля, добавленные к сущности **Заказ**, содержат сведения о затратах, состоянии контракта PSA и организации, которая получила контракт.

Также PSA расширяет сущность **Строка заказа на продажу**. Среди полей, которые добавлены, имеются поля, содержащие метод выставления счетов (время и материалы или фиксированная цена), суммы бюджета клиента и базовый проект.

PSA также добавляет новые сущности, предназначенные для контракта по проекту. Ниже приведено несколько примеров:

- **Сведение строки контракта проекта** — данная сущность содержит сведения на уровне строки, сведенные к сумме строки контракта. Они могут быть столь же детализированы, как и номенклатуры строк, создаваемые из расписания проекта на уровне задач.
- **Расписание счета строки контракта** — данная сущность содержит расписание выставления счетов, которое создается на основе частоты выставления счетов, назначенной строке контракта.
- **Веха контракта** — данная сущность содержит вехи выставления счетов для строк контракта с условием выставления счетов "фиксированная цена".

Остальные сущности, которые PSA добавляет в контракты, это **Прайс-лист проекта для строки контракта проекта**, **Категория ресурса строки контракта проекта** и **Категория проводки строки контракта проекта**.

![Диаграмма с взаимосвязями заказа, строки заказа и проекта](media/PS-Reporting-image3.png "Диаграмма с взаимосвязями заказа, строки заказа и проекта")

## <a name="reporting-on-projects"></a>Отчетность по проектам

Сущность **Проекты** и связанные с ней сущности эксклюзивные для PSA. **Проект** — это сущность верхнего уровня, которая используется для записи работы и затратной часть операций. Ниже приведен список связанных сущностей.

- **Участник проектной группы** — данная сущность содержит сведения о резервируемых ресурсах, которые назначены проекту. Эти ресурсы могут быть универсальными резервируемыми ресурсам или могут быть именными резервируемыми ресурсами, которые вводятся руководителем проекта или создаются из расписания проекта.
- **Задача проекта** — данная сущность содержит задачи, которые составляют план или расписание проекта.
- **Назначение ресурсов** — данная сущность содержит назначение задач для резервируемого ресурса.
- **Требование ресурса** — данная сущность содержит требования для любых участников группы универсальных ресурсов.
- **Оценка** и **Строка оценки** — эти сущности имеют отношения заголовка/строка и содержат оценки расходов для проекта. Оценки задач хранятся в сущности **Оценка ресурса**.

![Диаграмма с взаимосвязями требования ресурса и проекта](media/PS-Reporting-image4.png "Диаграмма с взаимосвязями требования ресурса и проекта")

## <a name="reporting-on-resources"></a>Отчетность по ресурсам

Ресурсы по проекту используют сущности **Резервируемый ресурс** из Universal Resource Scheduling (URS), которые являются общими с другими приложениями, такими как Microsoft Dynamics 365 Field Service. Ниже приведен список сущностей, которые вам могут потребоваться для отчета о ресурсах проекта:

- **Резервируемый ресурс** — данная сущность представляет пользователя, контакт, универсальный ресурс, организацию или оборудования, которые используются в проектной группе.
- **Характеристики резервируемого ресурса** — данная сущность включает навыки, сертификации или образование ресурса. Характеристики могут иметь значения оценки, которые определены моделью оценки.
- **Категория резервируемого ресурса** — данная сущность представляет роль резервируемого ресурса.
- **Резервирования резервируемого ресурса** — данная сущность представляет время, которое зарезервировано по проектам для этого ресурса. Каждое резервирование имеет сущность заголовка и сущности строки, и каждая строка имеет состояние, представляющее состояние резервирования.

![Диаграмма, показывающая взаимосвязи характеристик резервируемых ресурсов](media/PS-Reporting-image5.png "Диаграмма, показывающая взаимосвязи характеристик резервируемых ресурсов")

## <a name="reporting-on-actual-transactions"></a>Создание отчетов о фактических транзакциях

При утверждении табеля учета рабочего времени или расходов либо при выставлении счета по контракту в PSA бизнес-транзакция записывается в сущности **Факт**. Эта сущность может служить основой почти всех связанных с финансами отчетов в PSA. Сущность **Факт** записывает стоимость и транзакции продаж для бизнес-мероприятия. Она также записывает много связанных атрибутов.

При работе с сущностью **Факт** важно понимать, какая транзакция или транзакции записываются в сущность и когда транзакции записываются. Ниже приведен обычный поток при работе с записями времени (поток для записей расходов аналогичен):

1. При сохранении записи времени никакие записи не создаются в сущности **Факт**.
2. При отправке записи времени никакие записи не создаются в сущности **Факт**.
3. Когда запись время утверждена, одна запись была создана в сущности **Факт**, а вторая запись также может быть создана. Первая запись хранит стоимость записи времени. Вторая запись хранит сумму продажи записи времени, на которую не выставлен счет. Вторая записи зависит от того, что назначено проекту: клиент, предложение с расценками или строка контракта.

    | Дата документа | Тип проводки | Класс проводки | Клиент         | Контракт   | Ресурс     | Роль ресурса | Тип выставления счета | Количество | Цена единицы | Сумма |
    |---------------|------------------|-------------------|------------------|------------|--------------|---------------|--------------|----------|------------|--------|
    | 03.02.18        | Стоимость             | Time              | Alpine ski house | Alpine CRM | Аниса Комарова | Руководитель проекта   | Оплачивается   | 8.0      | 50.00      | 400.00 |
    | 03.02.18        | Продажи без выставления счета   | Time              | Alpine ski house | Alpine CRM | Аниса Комарова | Руководитель проекта   | Оплачивается   | 8.0      | 100.00     | 800.00 |

    Это две отдельные, но связанные записи. Они не являются ни дебитом, ни кредитом.

4. Если контракт связан с проектом, когда за запись времени выставляется счет, в сущности **Факт** создаются еще две записи. Во-первых, создается отрицательная сумма для записи продаж, за которую не выставлен счет. Эта запись в целом обращает продажу без выставления счета. Во-вторых, создается транзакция для продажи с выставленным счетом. Еще раз, это отдельные, но связанные записи, которые не являются ни дебитом, ни кредитом.

    | Дата документа | Тип проводки | Класс проводки | Клиент         | Контракт   | Ресурс     | Роль ресурса | Тип выставления счета | Количество | Цена единицы | Сумма   |
    |---------------|------------------|-------------------|------------------|------------|--------------|---------------|--------------|----------|------------|----------|
    | 04.02.18        | Продажи без выставления счета   | Time              | Alpine ski house | Alpine CRM | Аниса Комарова | Руководитель проекта   | Оплачивается   | - 8,0    | 100.00     | - 800,00 |
    | 04.02.18        | Продажи с выставлением счета     | Time              | Alpine ski house | Alpine CRM | Аниса Комарова | Руководитель проекта   | Оплачивается   | 8.0      | 100.00     | 800.00   |

Сущность **Происхождение проводки** содержит происхождение записи **Факт**, а сущность **Подключение проводки** содержит связанные записи для записи **Факт**. Кроме того, запись **Факт** содержит ссылки на проект, контракт по проекту (заказ), резервируемый ресурс и клиента.

![Диаграмма, показывающая взаимосвязь соединения транзакции, источника и фактических данных](media/PS-Reporting-image6.png "Диаграмма, показывающая взаимосвязь соединения транзакции, источника и фактических данных")


[!INCLUDE[footer-include](../includes/footer-banner.md)]