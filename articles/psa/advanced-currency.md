---
title: Сценарии с несколькими валютами (версия 3.x)
description: В этом разделе представлена информация о сценариях с несколькими валютами.
author: rumant
manager: kfend
ms.service: project-operations
ms.custom:
- dyn365-projectservice
ms.date: 12/26/2018
ms.topic: article
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.openlocfilehash: 33e44297dc80801c3e4416cd9fc3bedae5f3c4ba
ms.sourcegitcommit: fa32b1893286f20271fa4ec4be8fc68bd135f53c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2021
ms.locfileid: "5291725"
---
# <a name="multiple-currency-scenarios"></a>Сценарии с несколькими валютами

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

Microsoft Dynamics 365 имеет две концепции валют:

- **Валюта транзакции** — валюта, в которой производится транзакция. 
- **Базовая валюта** — валюта экземпляра Dynamics 365. Эта валюта настраивается при подготовке экземпляра Dynamics 365. Ее невозможно изменить.

Например, компания Contoso US продала 100 футболок клиенту из Великобритании по 15 фунтов (GBP) каждую. В следующей таблице показано, как эта транзакция записывается в сущности "Продукт для заказа".

| Продукт | Количество | Цена за единицу | Валюта | Сумма | Валютный курс | Цена за единицу (базовая)| Сумма (базовая)|
|---------|----------|----------------|----------|--------|---------------|----------------------|--------------|
| Футболка | 100      | 15             | GBP      | 1500   | 0.94          | 17.25 долларов               | 1,725 долларов       |

Столбец **Валюта** показывает валюту транзакции, которой является валюта, в которой произошла продажа. Столбец **Валютный курс** — это курс обмены валюты между валютой транзакции и базовой валютой. Базовая валюта — это доллар США (USD). Эта базовая валюта была настроена при подготовке экземпляра Dynamics 365.
Как показывает таблица, каждая транзакция регистрируется как в валюте транзакции, так и в базовой валюте. Dynamics 365 использует курс обмена валюты для вычисления сумм в базовой валюте.

## <a name="project-service-automation-extensions"></a>Расширения Project Service Automation

Dynamics 365 Project Service Automation влияет на валюту транзакции, поскольку бизнес-транзакции обычно имеют два аспекта: стоимость и продажи.

Следующие сущности считаются бизнес-транзакциями:

- Сведения строки предложения с расценками
- Сведения строки контракта проекта
- Строка оценки
- Строка журнала
- Сведения строки счета
- Фактические

В каждой из этих сущностей имеется запись, представляющая сумму стоимости или сумму продаж. Как и для любого объекта Dynamics 365, имеющего поле **Сумма**, каждая запись содержит суммы как в валюте транзакции, так и в базовой валюте. 

PSA расширяет концепцию валюты транзакций для стоимости и продаж следующими способами:

- Валюта транзакций стоимости для транзакций времени всегда берется из валюты подразделения, которое отвечает за проект или управляет им. Это подразделение называется единицей по контракту.
- Валюта транзакций продаж для транзакций времени и расходов всегда берется из валюты контракта по проекту.
- Валюта транзакций стоимости для расходов берется из валюты, в которой была создана запись расхода.

## <a name="multiple-currency-scenario"></a>Сценарий с несколькими валютами

В этом разделе описан пример проекта, который компания Contoso UK доставляет клиенту под названием Fabrikam, Japan. Вот как этот сценарий настроен:

1. GBP и японская иена (JPY) настроены в разделе **Параметры** \> **Управление бизнесом** \> **Валюты**. 
2. Настроена организация клиента с названием **Fabrikam - Japan**, и JPY выбрана как валюта этой организации.
3. Настроено подразделение с названием **Contoso UK**, и GBP выбрана как валюта.
4. Контракт по проекту создается, в котором **Contoso UK** указана как единица по контракту, и **Fabrikam – Japan** указана как клиент.
5. Создаются строки контракта по проекту, исходя из настроек выставления счетов для различных классов транзакций по проекту, таких как выставление счетов за время или выставления счетов за расходы.
6. Проект создается, в котором **Contoso UK** указана как единица по контракту. Этот проект создается и сопоставляются строками контракта по проекту.


В процессе оценки, в котором используются сведения строки предложения с расценками, сведения строки контракта по проекту или в строке оценки расписания, две записи всегда создаются в сущности. Одна запись для стоимости, другая запись для продаж.

- По умолчанию, валюта транзакций в записи стоимости устанавливается на валюту контрактной единицы по проекту. В данном примере это валюта GBP.
- По умолчанию, валюта транзакций в записи продаж устанавливается на валюту контракта по проекту. В данном примере это валюта JPY.

Когда фактические значения создаются для времени с использованием записи времени или строки журнала, поведение будет следующим:

- По умолчанию, валюта транзакций в записи стоимости устанавливается на валюту контрактной единицы по проекту.
- По умолчанию, валюта транзакций в записи продаж устанавливается на валюту контракта по проекту.

Когда фактические значения создаются для расходов по записи расходов или строки журнала, поведение будет следующим:

- Вы можете записывать сумму расходов в любой валюте. Выберите валюту с помощью средства выбора валюты на странице **Запись расхода** или **Строка журнала**. По умолчанию, валюта транзакций для записи стоимости устанавливается на валюту в записи расхода. 
- По умолчанию, валюта транзакций для записи продаж равна валюте контракта по проекту. Для настройки данной валюты система сначала преобразует сумму операции в валюту, которую пользователь ввел в базовую валюту. Затем сумма преобразуется в валюту контракта по проекту. 

### <a name="computing-roll-ups-when-project-actuals-are-recorded-in-multiple-transaction-currencies"></a>Вычисление сверток, когда фактические данные проекта записаны в нескольких валютах транзакций

Dynamics 365 автоматически обрабатывает свертки сумм в различных валютах. Ниже приведен пример.

| Класс проводки | Тип проводки| Date   | Ресурс | Категория проводки | Количество | Цена единицы | Сумма      | Валютный курс | Сумма в базовой |
|-------------------|------------------|--------|----------|----------------------|----------|--------------|-------------|---------------|----------------|
| Time              | Продажи без выставления счета   | 14 июня | Дементий  |                      | 8 ч    | 20 000 JPY    | 160 000 JPY | 123           | 1 300,81 USD    |
| Time              | Продажи без выставления счета   | 15 июня | Дементий  |                      | 8 ч    | 20 000 JPY    | 160 000 JPY | 123           | 1 300,81 USD    |
| Расходы           | Продажи без выставления счета   | 16 июня | Дементий  | Гостиница                | 1 ea     | 250 EUR      | 250 EUR     | 0.94          | 265,95 USD     |
| Расходы           | Продажи без выставления счета   | 17 июня | Дементий  | Прокат автомобиля           | 1 ea     | 150 EUR      | 150 EUR     | 0.94          | 159,57 USD     |

Для вычисления общей суммы продаж без выставления счета по проекту можно создать поле свертки для поля **Сумма** на всех связанных фактических значениях продаж без выставления счета. Поле свертки представляет собой конструкцию Dynamics 365, которая позволяет создавать быстрые формулы для связанных записей.


[!INCLUDE[footer-include](../includes/footer-banner.md)]