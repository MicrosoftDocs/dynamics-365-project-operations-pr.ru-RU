---
title: Как настроить последовательность операций бизнес-процесса стадий проекта?
description: Обзор порядка настройки последовательности операций бизнес-процесса стадий проекта.
manager: kfend
ms.service: project-operations
ms.custom:
- dyn365-projectservice
ms.date: 10/11/2018
ms.topic: article
author: JohnPBurrows
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.openlocfilehash: 0f95677c56b745bf7900ad503596c93f1e722281
ms.sourcegitcommit: fa32b1893286f20271fa4ec4be8fc68bd135f53c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/15/2021
ms.locfileid: "5286174"
---
# <a name="how-do-i-customize-the-project-stages-business-process-flow"></a>Как настроить последовательность операций бизнес-процесса стадий проекта?

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-2-4x-9-0-platform](../includes/cc-applies-to-psa-app-2-4x-9-0-platform.md)]
[!INCLUDE[cc-applies-to-psa-app-1x-8-2-platform](../includes/cc-applies-to-psa-app-1x-8-2-platform.md)]

Известное ограничение в предыдущих версиях приложения Project Service требует, чтобы названия стадий в последовательности операций бизнес-процесса полностью совпадали с ожидаемыми английскими именам (**Quote**, **Plan**, **Close**). В противном случае бизнес-логика, которая полагается на английские имена, не будет работать надлежащим образом. Поэтому вы не видите знакомые действия, такие как **Переключить процесс** или **Изменить процесс**, в форме проекта, и настройка последовательности операций бизнес-процесса не поощряется. 

Это ограничение было устранено в версии 2.4.5.48 и более поздних версиях. В данной статье приведены предлагаемые временные решения, если необходимо настроить последовательность операций бизнес-процесса по умолчанию для более ранних версий.  

## <a name="business-logic-requires-an-exact-match-with-english-stage-names"></a>Бизнес-логика требует полного совпадения с именами стадий на английском языке

Последовательность операций бизнес-процесса стадий проекта включает бизнес-логику, которая управляет следующим поведением в приложении:
- Когда проект связан с предложением с расценками, код задает последовательность операций бизнес-процесса для стадии **Quote**.
- Когда проект связан с контрактом, код задает последовательность операций бизнес-процесса для стадии **Plan**.
- Когда последовательность операций бизнес-процесса переходит на стадию **Close**, запись проекта деактивируется. Когда проект деактивирован, форма проекта и структурная декомпозиция работ (WBS) становятся доступны только для чтения, резервирования именованных ресурсов освобождаются, и все связанные прайс-листы деактивируются.

Эта бизнес-логика полагается на английские имена стадий проекта. Эта зависимость от английских имен стадий является главной причиной, по которой настройка последовательности операций бизнес-процесса стадий проекта не поощряется, а также по этой причине вы не видите часто используемые действия последовательности операций бизнес-процесса, такие как **Переключить процесс** или **Изменить процесс** в сущности проекта.

## <a name="what-happens-if-the-stage-names-dont-match-the-english-names"></a>Что происходит, если имена стадий не совпадают с английскими именами?

В версии 1.x приложения Project Service на платформе 8.2 когда имена стадий в последовательности операций бизнес-процесса не соответствуют в точности английским именам стадий, бизнес-логика, которая определяет правильные стадии для предложений с расценками или контрактов или закрывает проект, пропускается. Сообщения об ошибках не отображаются. Поэтому возникает впечатление, что можно настраивать последовательность операций бизнес-процесса стадий проекта. Однако вы не увидите такие автоматические процессы, работающие для предложений с расценками, контрактов и закрытия проекта.

В версии 2.4.4.30 приложения Project Service или раннее на платформе 9.0 было сделано значительное архитектурное изменение в последовательностях операций бизнес-процессов, которое требуют переработки бизнес-логики последовательности операций бизнес-процесса. В результате если имена стадий процесса не совпадают с ожидаемыми английскими именами, вы получите сообщение об ошибке. 

Поэтому, если требуется настроить последовательность операций бизнес-процесса стадий проекта для сущности проекта, можно добавить лишь совершенно новые стадии в последовательность операций бизнес-процесса по умолчанию, сохранив стадии **Quote**, **Plan** и **Close** без изменений. Это ограничение обеспечивает, чтобы не возникали ошибки из бизнес-логики, которая ожидает имена стадий на английском языке в последовательности операций бизнес-процесса.

В версии 2.4.5.48 или выше бизнес-логика, описанная в этой статье, была удалена из последовательности операций бизнес-процесса по умолчанию для сущности проекта. Обновление до этой или более поздней версии позволит настраивать или заменять последовательность операций бизнес-процесса по умолчанию своей собственной. 

## <a name="workarounds-for-earlier-versions"></a>Обходные решения для более ранних версий

Если обновление невозможно, можно настроить последовательность операций бизнес-процесса стадий проекта для сущности проекта одним из следующих двух способов:

1. Добавить дополнительные стадии в конфигурацию по умолчанию, сохранив английские имена стадий **Quote**, **Plan** и **Close**.


![Снимок экрана добавления стадий в конфигурацию по умолчанию](media/FAQ-Customize-BPF-1.png)
 
2. Создать собственную последовательность операций бизнес-процесса и сделать ее основной последовательностью операций бизнес-процесса для сущности проекта, что позволит задать любые требуемые имена стадий. Однако если необходимо использовать стандартные стадии проекта **Quote**, **Plan** и **Close**, необходимо выполнить некоторые настройки, которые управляются вашими настраиваемыми именами стадий. Более сложная логика находится в закрытии проекта, которую по-прежнему можно запустить, просто деактивировав запись проекта.

![Настройка BPF](media/FAQ-Customize-BPF-2.png)

### <a name="additional-considerations-for-project-service-app-version-24430-or-earlier-on-platform-90"></a>Дополнительные замечания для приложения Project Service версии 2.4.4.30 или ранее на платформе 9.0

В приложении Project Service версии 2.4.4.30 или более ранней на платформе 9.0 с настраиваемой последовательностью операций бизнес-процесса поле **Имя стадии** в сущности проекта, используемое в представлениях диаграммы **Проект по стадии** и списка проектов, не будет обновляться, поскольку оно связано с последовательностью операций бизнес-процесса стадий проекта по умолчанию. Эту проблему можно решить, выполнив следующие действия.

- Добавьте настраиваемое поле для захвата текущей стадии последовательности операций бизнес-процесса, которое обновляется, когда пользователь проходит по пользовательской последовательности операций бизнес-процесса.

- Измените диаграмму **Проект по стадии** для работы с настраиваемым полем вместо конфигурации по умолчанию.

### <a name="steps-to-create-your-own-business-process-flow-for-the-project-entity"></a>Шаги для создания вашей собственной последовательности операций бизнес-процесса для сущности проекта

Чтобы создать собственную последовательность операций бизнес-процесса для сущности проекта, выполните следующие действия:

1. Перейдите в раздел **Параметры** > **Центр обработки**. Не копируйте последовательность операций бизнес-процесса стадий проекта, поскольку при этом выполняется копирование также бизнес-логики Project Service.

  ![Создание процесса](media/FAQ-Customize-BPF-3.png)

2. Используйте конструктор процессов для создания требуемых имен стадий. Если требуются те же функциональные возможности, что и стадии по умолчанию для **Quote**, **Plan** и **Close**, необходимо создать их на основе имен стадий вашей настраиваемой последовательности операций бизнес-процесса.

   ![Снимок экрана конструктора процессов, используемого для настройки BPF](media/FAQ-Customize-BPF-4.png) 

3. В конструкторе процессов нажмите **Последовательность операций процесса заказа**, чтобы сделать настраиваемую последовательность операций бизнес-процесса основной последовательностью операций бизнес-процесса для сущности проекта, переместив ее над последовательностью операций бизнес-процесса стадий проекта на верх списка.


   [Снимок экрана использования последовательности операций заказа](media/FAQ-Customize-BPF-5-720.png)

### <a name="the-following-steps-apply-to-project-service-app-24430-or-earlier-on-the-90-platform"></a>Следующие действия применимы к приложению Project Service 2.4.4.30 или ранее на платформе 9.0

4. Добавьте новое настраиваемое поле в сущность проекта для захвата настраиваемых стадий в вашей настраиваемой последовательности операций бизнес-процесса. Потребуется добавить бизнес-логику (подключаемый модуль или бизнес-процесс) для обновления этого поля, когда стадия в настраиваемой последовательности операций бизнес-процесса обновляется.

   ![Снимок экрана настраиваемой сущности проекта](media/FAQ-Customize-BPF-6-720.png)

5. Измените диаграмму **Проект по стадии** для использования вашего нового настраиваемого поля для стадий.

   ![Снимок экрана использования диаграммы "Проект по стадии"](media/FAQ-Customize-BPF-7-720.png)

6. Измените все представления для сущности проекта для включения вашего нового настраиваемого поля для стадий.

   ![Снимок экрана изменения представлений сущности проекта](media/FAQ-Customize-BPF-8-720.png)



[!INCLUDE[footer-include](../includes/footer-banner.md)]