---
title: Добавление настраиваемых полей к настройке цены и транзакционным сущностям
description: В этом разделе представлена информация о добавлении настраиваемых полей настройку цены и транзакционные сущности.
author: Rumant
ms.custom:
- dyn365-projectservice
ms.date: 10/01/2020
ms.topic: article
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365PS
- ProjectOperations
ms.reviewer: johnmichalak
ms.openlocfilehash: cb4a99b10e5d0c79e80bcd46d2f60ccdab4487aa
ms.sourcegitcommit: c0792bd65d92db25e0e8864879a19c4b93efb10c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/14/2022
ms.locfileid: "8596940"
---
# <a name="add-custom-fields-to-price-setup-and-transactional-entities"></a>Добавление настраиваемых полей к настройке цены и транзакционным сущностям 

[!include [banner](../includes/psa-now-project-operations.md)]

В этом разделе предполагается, что пользователь выполнил процедуры из раздела [Создание настраиваемых полей и сущностей](create-custom-fields-entities.md). Если вы еще не завершили эти процедуры, вернитесь и выполните их, а затем вернитесь к этому разделу. 

В этом разделе процедуры покажут, как добавить необходимые ссылки на настраиваемые поля в сущности и в элементы пользовательского интерфейса (UI), такие как формы и представления.

## <a name="add-custom-pricing-dimension-fields"></a>Добавление настраиваемых полей аналитики ценообразования 
После создания настраиваемых полей и сущностей следующим шагом будет сделать так, чтобы настройка цены и транзакционные сущности учитывали все настраиваемые сущности или наборы параметров, путем создания ссылочных полей. В зависимости от того, включает ли ваш список аналитик ценообразования аналитики набора параметров, аналитики сущностей или и то, и другое, выполните только шаги из раздела **Настраиваемые аналитики ценообразования на основе набора параметров** или **Настраиваемые аналитики ценообразования на основе сущностей**, или из обоих разделов, соответственно.

### <a name="option-set-based-custom-pricing-dimensions"></a>Настраиваемые аналитики ценообразования на основе набора параметров
Если настраиваемая аналитика ценообразования основана на наборе параметров, добавьте ее в качестве поля в основные сущности Project Service. В следующей процедуре аналитики **Место работы ресурса** и **Рабочие часы ресурса** используются в качестве аналитик ценообразования на основе набора параметров. Они должны быть сначала добавлены как поля в сущности ценообразования, **Цена роли** и **Надбавка цены роли**.

1. В Project Service Automation (PSA) щелкните **Параметры** > **Решения**, затем дважды щелкните **Аналитики ценообразования \<your organization name>**. 
2. В обозревателе решений в левой навигационной панели выберите **Сущности > Цена роли**.
3. Разверните сущность **Цена роли** и выберите пункт **Поля**.
4. Щелкните **Создать**, чтобы создать новое поле с именем **Место работы ресурса** и выберите **Набор параметров** в качестве типа поля. 
5. Выберите **Использовать существующий набор параметров**, выберите набор параметров **Место работы ресурса**, затем щелкните **Сохранить**.
6. Повторите шаги с 1 по 5 для добавления этого поля в сущность **Надбавка цены роли**. 
7. Повторите шаги с 1 по 5 для набора параметров **Рабочие часы ресурса**.

> [!IMPORTANT]
> При добавлении поля в несколько сущностей используйте одинаковое имя поля для всех сущностей. 

> ![Добавление места работы ресурса в цену роли.](media/RWL-Field.png)

На этапах продажи и оценки для проекта оценки усилий работы, необходимых для выполнения **Локальной** и **На месте** работы, в **обычных часах** и **сверхурочных часах** используются для оценки стоимости предложения с расценками/проекта. Поля **Место работы ресурса** и **Рабочие часы ресурса** будут добавлены в сущности оценки, **Сведения строки предложения с расценками**, **Сведения строки контракта**, **Задача проекта**, **Участник проектной группы** и **Строка оценки**.

1. В PSA щелкните **Параметры** > **Решения** и затем дважды щелкните **Измерения ценообразования \<your organization name>**. 
2. В обозревателе решений в левой навигационной панели выберите **Сущности > Сведения строки предложения с расценками**.
3. Разверните сущность **Сведения строки предложения с расценками** и выберите **Поля**.
4. Щелкните **Создать**, чтобы создать новое поле с именем **Место работы ресурса** и выберите тип поля **Набор параметров**. 
5. Выберите **Использовать существующий набор параметров** и **Место работы ресурса**, затем щелкните **Сохранить**.
6. Повторите шаги с 1 по 5 для добавления этого поля в сущности **Сведения строки контракта проекта**, **Задача проекта**, **Участник проектной группы** и **Строка оценки**.
7. Повторите шаги с 1 по 6 для набора параметров **Рабочие часы ресурса**. 

> ![Добавление места работы ресурса в строку оценки.](media/RWL-Default-Value.png)


Для доставки и выставления счетов выполненную работу необходимо точно оценить, чтобы выбрать, была ли она выполнена **Локально** или **На месте** и была ли она завершена во время **Обычных часов** или **Сверхурочных часов** в фактических данных проекта. Поля **Место работы ресурса** и **Рабочие часы ресурса** необходимо добавить в сущности **Запись времени**, **Факт**, **Сведения строки счета** и **Строка журнала**.

1. В PSA щелкните **Параметры** > **Решения** и затем дважды щелкните **Измерения ценообразования \<your organization name>**.
2. В обозревателе решений в левой навигационной панели выберите **Сущности > Запись времени**.
3. Разверните сущность **Сведения строки предложения с расценками**, затем выберите **Поля**.
4. Щелкните **Создать**, чтобы создать новое поле с именем **Место работы ресурса** и выберите **Набор параметров** в качестве типа поля. 
5. Выберите **Использовать существующий набор параметров**, выберите набор параметров **Место работы ресурса**, затем щелкните **Сохранить**.
6. Повторите шаги с 1 по 5 для добавления этого в сущности **Факт**, **Сведения строки счета** и **Строка журнала**.
7. Повторите шаги с 1 по 6 для набора параметров **Рабочие часы ресурса**. 

> ![Добавление места работы ресурса в строку журнала.](media/RWL-time-entry.png)

Это завершает изменения схемы, необходимые для настраиваемых аналитик на основе набора параметров.

## <a name="entity-based-custom-pricing-dimensions"></a>Настраиваемые аналитики ценообразования на основе сущностей

Если настраиваемая аналитики ценообразования является сущностью, вы добавляете отношения 1:N между сущностью аналитики и основными сущностями Project Service. Используя пример стандартного заголовка выше, разумно ожидать, что каждому сотруднику назначен стандартный заголовок. В результате потребуется отношение 1:N из стандартного заголовка в резервируемый ресурс или отношение N:1, если оно было создано из резервируемого ресурса в стандартный заголовок.

1. В PSA щелкните **Параметры** > **Решения** и затем дважды щелкните **Измерения ценообразования \<your organization name>**. 
2. В обозревателе решений в левой навигационной панели выберите **Сущности > Стандартный заголовок**.
3. Разверните сущность **Стандартный заголовок** и выберите **Отношения 1: N**.
4. Щелкните **Создать**, чтобы создать новое отношение 1: N, называющееся **Стандартный заголовок в резервируемый ресурс**. Введите обязательные сведения, затем щелкните **Сохранить**.

> ![Добавление стандартного заголовка как поля ссылки на резервируемый ресурс.](media/ST-BR.png)

Стандартный заголовок также потребуется добавить в сущности ценообразования Project Service, **Цена роли** и **Наценка цены роли**. Это также выполняется с помощью отношения 1:N между сущностями **Стандартный заголовок** и **Цена роли** и сущностями **Стандартный заголовок** и **Наценка цены роли**.

1. В обозревателе решений в левой навигационной панели выберите **Сущности > Стандартный заголовок**.
2. Разверните сущность **Стандартный заголовок** и выберите **Отношения 1: N**.
3. Щелкните **Создать**, чтобы создать новое отношение 1: N, называющееся **Стандартный заголовок в цену роли**. Введите обязательные сведения, затем щелкните **Сохранить**.
4. Повторите шаги с 1 по 4 для создания отношения 1:N между сущностями **Стандартный заголовок** и **Наценка цены роли**.

На этапах продажи и оценки проекта для определения цены предложения с расценками/проекта требуются оценки усилий работы для каждого стандартного заголовка. Это означает, что требуются отношения 1:N из стандартного заголовка с каждой из этих сущностей оценки в Project Service: 

- **Сведения строки предложения с расценками**
- **Сведения строки контракта проекта**
- **Задача проекта**
- **Участник проектной группы**
- **Строка оценки**

5. Повторите шаги с 1 по 5 для создания отношения 1:N из сущности **Стандартный заголовок** в сущности **Сведения строки предложения с расценками**, **Сведения строки контракта проекта**, **Задача проекта**, **Участник проектной группы** и **Строка оценки**.

> ![Добавление стандартного заголовка как поля ссылки на строку оценки.](media/ST-Estimate-Line.png)

На этапах доставки и выписки счета работа, выполненная каждым стандартным заголовком, должна быть точно оценена в фактических показателях проекта. Это означает, что необходимы отношения 1:N из сущности **Стандартный заголовок** в сущности **Запись времени**, **Факт**, **Сведения строки счета** и **Строка журнала**.

6. Повторите шаги с 1 по 6 для создания отношений 1:N из сущности **Стандартный заголовок** в сущности **Запись времени**, **Факт**, **Сведения строки счета** и **Строка журнала**.

> ![Добавление стандартного заголовка как поля ссылки на запись времени.](media/ST-Mapping.png)

### <a name="set-up-dimension-value-defaulting-using-the-mappings-features-of-the-platform"></a>Настройка значения аналитики по умолчанию с использованием функции сопоставления платформы
Для записи времени будет полезно, чтобы система по умолчанию назначала стандартный заголовок в записи времени из резервируемого ресурса, который записывает запись времени. Используйте следующие шаги для добавления сопоставлений полей в отношение 1:N из сущности **Резервируемый ресурс** в **Запись времени**.

1. В обозревателе решений в левой навигационной панели выберите **Сущности > Стандартный заголовок**.
2. Разверните сущность **Стандартный заголовок** и выберите **Отношения 1: N**.
3. Дважды щелкните **Резервируемый ресурс в запись времени**. На странице **Отношение** щелкните **Использовать сопоставления полей**. 
4. Щелкните **Создать**, чтобы создать новое сопоставление полей между полем **Стандартный заголовок** сущности **Резервируемый ресурс** с ссылочным полем **Стандартный заголовок** сущности **Запись времени**. 

> ![Настройка сопоставления полей, чтобы стандартный заголовок по умолчанию устанавливался из резервируемого ресурса в записи времени.](media/ST-Mapping2.png)


Это завершает изменения схемы, необходимые для настраиваемых аналитик на основе сущности.

##  <a name="add-custom-fields-to-forms-views-and-business-rules"></a>Добавление настраиваемых полей в формы, представления и бизнес-правила.

После внесения всех необходимых изменений схемы следующим шагом следует сделать поля видимыми в интерфейсе пользователя, добавив эти поля в формы и представления.

1. Откройте форму или представление. В правой области переходов выберите поле и перетащите его на холст формы. 
2. При изменении представления используйте правую область переходов, щелкните **Добавить поля**, и в диалоговом окне **Список полей** выберите требуемые поля и щелкните **ОК**.

Следующая таблица содержит полный список готовых форм и представлений, по сущностям, которые следует обновить с учетом новых полей. При наличии любых дополнительных форм или представлений в ваших настройках для этих сущностей, добавьте новые поля также и в них.

| Сущность Project Service        | Формы, в которых требуется новое поле   |Представления, в которых требуется новое поле      |
| ------------------------------|---------------------------------|----------------------------------|
|  Цена роли|• Сведения |• Активные цены категории ресурса<br> • Представление связанной цены категорий ресурсов|
|  Наценка цены роли|• Сведения|• Активная наценка цены роли<br>• Связанное представление наценки цены роли|
|  Сведения строки предложения с расценками|• Сведения о проекте<br>• Быстрое создание проекта|• Активные сведения строки предложения с расценками<br>• Объединенные сведения строки предложения с расценками<br>• Представление связанных сведений строки предложения с расценками|
|  Сведения строки контракта проекта|• Сведения о проекте<br>• Быстрое создание проекта|• Объединенные сведения строки контракта<br>• Активные сведения строки контракта<br>• Связанное представление сведений строки контракта|
|  Задача проекта|• Сведения<br>• Новая форма||
|  Участник проектной группы|• Сведения<br>• Новая форма|• Активные участники проектной группы<br>• Участники рабочей группы проекта<br>• Представление связанных участников проектной группы|
|  Запись времени|• Сведения<br>• Создание записи времени|• Мои записи времени по дате<br>• Мои записи времени за эту неделю<br>• Записи времени для утверждения.|
|  Строка журнала|• Сведения<br>• Быстрое создание|• Активные строки журнала<br>• Представление связанной строки журнала|
|  Сведения строки счета|• Сведения<br>• Быстрое создание|• Активные сведения строки счета<br>• Подлежащие оплате проводки по счету<br>• Бесплатные проводки по счету<br>• Представление связанных сведений строки счета<br>• Не подлежащие оплате проводки по счету|
|  Фактические|• Сведения<br>• Активные фактические данные|• Представление связанных фактических данных|

Настраиваемые поля также может потребоваться добавить в бизнес-правила в зависимости от того, что было определено. Одним из готовых примеров будет бизнес-правило **Возможность редактирования записи времени на основании состояния**. Это правило определяет, какие поля должны быть заблокированы, когда запись времени находится в состоянии, не допускающем редактирования, например **Утверждена**. Добавьте поля к этому бизнес-правилу, чтобы эти поля блокировались для редактирования, когда запись времени находится в состоянии, отличном от **Черновик** или **Возвращено**.


[!INCLUDE[footer-include](../includes/footer-banner.md)]
